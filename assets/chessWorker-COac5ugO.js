(function(){"use strict";var ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Z={},K={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(K,"__esModule",{value:!0}),K.i18n=void 0;var tn;(function(e){e.WRONG_NUMBER_OF_FEN_FIELDS="A FEN string must contain exactly 6 space-separated fields.",e.WRONG_NUMBER_OF_SUBFIELDS_IN_BOARD_FIELD="The 1st field of a FEN string must contain exactly 8 `/`-separated subfields.",e.UNEXPECTED_CHARACTER_IN_BOARD_FIELD="Unexpected character in the 1st field of the FEN string: `{0}`.",e.UNEXPECTED_END_OF_SUBFIELD_IN_BOARD_FIELD="Subfield {0} of the FEN string 1st field is unexpectedly short.",e.INVALID_TURN_FIELD="The 2nd field of a FEN string must be either `w` or `b`.",e.INVALID_CASTLING_FIELD="The 3rd field of a FEN string must be either `-` or a list of characters among `K`, `Q`, `k` and `q` (in this order).",e.INVALID_EN_PASSANT_FIELD="The 4th field of a FEN string must be either `-` or a square from the 3rd or 6th rank where en-passant is allowed.",e.WRONG_RANK_IN_EN_PASSANT_FIELD="The rank number indicated in the FEN string 4th field is inconsistent with respect to the 2nd field.",e.INEFFECTIVE_EN_PASSANT_FIELD="No en-passant capture can happen on file {0} in the position defined in the FEN string.",e.INVALID_HALF_MOVE_COUNT_FIELD="The 5th field of a FEN string must be a number, indicating the number of half-move since the last pawn move or capture.",e.INVALID_MOVE_NUMBER_FIELD="The 6th field of a FEN string must be a number, indicating the move number of the game.",e.INVALID_VARIANT_PREFIX="Invalid variant prefix: `{0}`.",e.INVALID_UCI_NOTATION_SYNTAX="The syntax of the UCI notation is invalid.",e.ILLEGAL_UCI_MOVE="The UCI move is not legal.",e.INVALID_MOVE_NOTATION_SYNTAX="The syntax of the move notation is invalid.",e.ILLEGAL_POSITION="The position is not legal.",e.ILLEGAL_NO_KING_CASTLING="Castling is not legal in the considered position as it has no king.",e.ILLEGAL_QUEEN_SIDE_CASTLING="Queen-side castling is not legal in the considered position.",e.ILLEGAL_KING_SIDE_CASTLING="King-side castling is not legal in the considered position.",e.NO_PIECE_CAN_MOVE_TO="No {0} can move to {1}.",e.NO_PIECE_CAN_MOVE_TO_DISAMBIGUATION="No {0} on the specified rank/file can move to {1}.",e.REQUIRE_DISAMBIGUATION="Cannot determine uniquely which {0} is supposed to move to {1}.",e.WRONG_DISAMBIGUATION_SYMBOL="Wrong disambiguation symbol (expected: `{0}`, observed: `{1}`).",e.CASTLING_MOVE_ENCODED_WITH_ZERO="Capital O must be used for castling moves (instead of digit 0).",e.TRYING_TO_CAPTURE_YOUR_OWN_PIECES="Capturing its own pieces is not legal.",e.CAPTURE_IS_MANDATORY="Capture is mandatory.",e.INVALID_PIECE_SYMBOL="Character `{0}` is not a valid piece symbol.",e.INVALID_PIECE_SYMBOL_COLOR="Invalid color for piece symbol `{0}`.",e.INVALID_CAPTURING_PAWN_MOVE="Invalid capturing pawn move.",e.INVALID_NON_CAPTURING_PAWN_MOVE="Invalid non-capturing pawn move.",e.NOT_SAFE_FOR_WHITE_KING="This move would let the white king in check.",e.NOT_SAFE_FOR_BLACK_KING="This move would let the black king in check.",e.MISSING_PROMOTION="A promoted piece must be specified for this move.",e.MISSING_PROMOTION_SYMBOL="Character `=` is required to specify a promoted piece.",e.INVALID_PROMOTED_PIECE="{0} cannot be specified as a promoted piece.",e.ILLEGAL_PROMOTION="Specifying a promoted piece is illegal for this move.",e.ILLEGAL_NULL_MOVE="Cannot play a null-move in this position.",e.MISSING_CAPTURE_SYMBOL="Capture symbol `x` is missing.",e.INVALID_CAPTURE_SYMBOL="This move is not a capture move.",e.WRONG_CHECK_CHECKMATE_SYMBOL="Wrong check/checkmate symbol (expected: `{0}`, observed: `{1}`).",e.INVALID_PGN_TOKEN="Unrecognized character or group of characters.",e.INVALID_MOVE_IN_PGN_TEXT="Invalid move ({0}). {1}",e.INVALID_FEN_IN_PGN_TEXT="Invalid FEN string in the initial position header. {0}",e.UNEXPECTED_PGN_HEADER="Unexpected PGN game header.",e.MISSING_PGN_HEADER_ID="Missing or invalid PGN game header ID.",e.MISSING_PGN_HEADER_VALUE="Missing or invalid PGN game header value.",e.MISSING_END_OF_PGN_HEADER="Missing or invalid end of PGN game header.",e.UNEXPECTED_BEGIN_OF_VARIATION="Unexpected begin of variation.",e.UNEXPECTED_END_OF_VARIATION="Unexpected end of variation.",e.UNEXPECTED_END_OF_GAME="Unexpected end of game: there are pending variations.",e.INVALID_GAME_INDEX="Game index {0} is invalid (only {1} game(s) found in the PGN data).",e.UNKNOWN_VARIANT="Unknown chess game variant ({0}).",e.VARIANT_WITHOUT_FEN="For game variant {0}, the FEN header is mandatory.",e.POJO_MUST_BE_AN_OBJECT="Unexpected non-object value passed as POJO.",e.INVALID_POJO_STRING_FIELD="Invalid value (must be a string).",e.INVALID_POJO_NUMBER_FIELD="Invalid value (must be a number).",e.INVALID_POJO_BOOLEAN_FIELD="Invalid value (must be a boolean).",e.INVALID_POJO_OBJECT_FIELD="Invalid value (must be an object).",e.INVALID_POJO_ARRAY_FIELD="Invalid value (must be an array).",e.INVALID_ELO_IN_POJO="Ill-formed elo.",e.INVALID_ROUND_IN_POJO="Ill-formed round, sub-round or sub-sub-round.",e.INVALID_DATE_IN_POJO="Ill-formed date.",e.INVALID_ECO_CODE_IN_POJO="Ill-formed ECO code.",e.INVALID_RESULT_IN_POJO="Ill-formed result.",e.INVALID_VARIANT_IN_POJO="Ill-formed variant.",e.INVALID_NAG_IN_POJO="Invalid NAG ({0}).",e.INVALID_TAG_IN_POJO="Invalid tag ({0}).",e.INVALID_MOVE_IN_POJO="Invalid move ({0}). {1}",e.INVALID_FEN_IN_POJO="Invalid initial position FEN. {0}",e.MISSING_INITIAL_POSITION_IN_POJO="For game variant {0}, the initial position field is mandatory.",e.INVALID_OR_MISSING_NODE_ARRAY="Invalid or missing node POJO array.",e.INVALID_OR_MISSING_NOTATION_FIELD="Invalid or missing node POJO.",e.NOT_A_NODE_POJO="A node POJO must be either a string or an object.",e.NOT_A_VARIATION_POJO="A variation POJO must be either an array or an object."})(tn||(K.i18n=tn={}));var v={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(v,"__esModule",{value:!0}),v.InvalidPOJO=v.InvalidPGN=v.InvalidNotation=v.InvalidFEN=v.IllegalArgument=void 0;class wi{constructor(t){this.functionName=t}toString(){return`Illegal argument in function ${this.functionName}`}}v.IllegalArgument=wi;class Ai{constructor(t,n,...i){this.fen=t,this.message=nt(n,i)}toString(){return it("InvalidFEN",this.message)}}v.InvalidFEN=Ai;class ki{constructor(t,n,i,...r){this.fen=t,this.notation=n,this.message=nt(i,r)}toString(){return it("InvalidNotation",this.message)}}v.InvalidNotation=ki;class Si{constructor(t,n,i,r,...a){this.pgn=t,this.index=n,this.lineNumber=i,this.message=nt(r,a)}toString(){return it("InvalidPGN",`[character=${this.index} line=${this.lineNumber}] ${this.message}`)}}v.InvalidPGN=Si;class Ci{constructor(t,n,i,...r){this.pojo=t,this.fieldName=n,this.message=nt(i,r)}toString(){return it("InvalidPOJO",this.message)}}v.InvalidPOJO=Ci;function nt(e,t){return e.replace(/{(\d+)}/g,(n,i)=>{const r=Number(i);return r<t.length?String(t[r]):n})}function it(e,t){return e+" -> "+t}var E={},I={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(I,"__esModule",{value:!0}),I.colorToString=Oi,I.pieceToString=Ti,I.fileToString=Mi,I.rankToString=Fi,I.resultToString=Vi,I.variantToString=Li,I.colorFromString=Ri,I.pieceFromString=yi,I.fileFromString=Di,I.rankFromString=Gi,I.resultFromString=qi,I.variantFromString=Ki,I.squareToString=Bi,I.squareFromString=$i,I.coloredPieceToString=xi,I.coloredPieceFromString=Ui,I.figurineToString=Qi,I.figurineFromString=Wi,I.squareColorImpl=ji;const rt=[..."wb"],at=[..."kqrbnp"],st=[..."abcdefgh"],ot=[..."12345678"],nn=["1-0","0-1","1/2-1/2","*"],rn=["regular","chess960","no-king","white-king-only","black-king-only","antichess","horde"],an=[..."♔♚♕♛♖♜♗♝♘♞♙♟"];function Oi(e){return rt[e]}function Ti(e){return at[e]}function Mi(e){return st[e]}function Fi(e){return ot[e]}function Vi(e){return nn[e]}function Li(e){return rn[e]}function Ri(e){return typeof e=="string"?rt.indexOf(e):-1}function yi(e){return typeof e=="string"?at.indexOf(e):-1}function Di(e){return typeof e=="string"?st.indexOf(e):-1}function Gi(e){return typeof e=="string"?ot.indexOf(e):-1}function qi(e){return typeof e=="string"?nn.indexOf(e):-1}function Ki(e){return typeof e=="string"?rn.indexOf(e):-1}function Bi(e){return st[e%16]+ot[Math.trunc(e/16)]}function $i(e){if(typeof e!="string"||!/^[a-h][1-8]$/.test(e))return-1;const t=st.indexOf(e[0]);return ot.indexOf(e[1])*16+t}function xi(e){return rt[e%2]+at[Math.trunc(e/2)]}function Ui(e){if(typeof e!="string"||!/^[wb][kqrbnp]$/.test(e))return-1;const t=rt.indexOf(e[0]);return at.indexOf(e[1])*2+t}function Qi(e){return an[e]}function Wi(e){return an.indexOf(String(e))}function ji(e){return(~e^e>>4)&1}var ee={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(ee,"__esModule",{value:!0}),ee.hasCanonicalStartPosition=Ji,ee.makeEmpty=Xi,ee.makeInitial=Yi,ee.make960FromScharnagl=zi,ee.makeCopy=er;const Hi=[-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1],sn=[4,8,6,2,0,6,8,4,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,11,11,11,11,11,11,11,11,-2,-2,-2,-2,-2,-2,-2,-2,5,9,7,3,1,7,9,5],on=[{board:sn,castling:[129,129],king:[4,116]},null,null,null,null,{board:sn,castling:[0,0],king:[-1,-1]},{board:[10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,-1,10,10,-1,-1,10,10,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,11,11,11,11,11,11,11,11,-2,-2,-2,-2,-2,-2,-2,-2,5,9,7,3,1,7,9,5],castling:[0,129],king:[-1,116]}];function Ji(e){return on[e]!==null}function Xi(e){return{board:Hi.slice(),turn:0,castling:[0,0],enPassant:-1,variant:e,legal:e===2,king:[-1,-1],effectiveCastling:[0,0],effectiveEnPassant:-1}}function Yi(e){const t=on[e];return{board:t.board.slice(),turn:0,castling:t.castling.slice(),enPassant:-1,variant:e,legal:!0,king:t.king.slice(),effectiveCastling:t.castling.slice(),effectiveEnPassant:-1}}function zi(e){const t=Zi(e),n=t.pieceScheme.map(r=>r*2+0),i=t.pieceScheme.map(r=>r*2+1);return{board:[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,11,11,11,11,11,11,11,11,-2,-2,-2,-2,-2,-2,-2,-2,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]],turn:0,castling:[t.castling,t.castling],enPassant:-1,variant:1,legal:!0,king:[0+t.kingFile,112+t.kingFile],effectiveCastling:[t.castling,t.castling],effectiveEnPassant:-1}}function Zi(e){const t=[-1,-1,-1,-1,-1,-1,-1,-1];let n=0,i=-1;function r(s){let o=0;for(let l=0;l<8;++l)t[l]>=0||(s(l,o),++o)}function a(s,o,l){r((u,f)=>{(f===o||f===l)&&(t[u]=s)})}switch(t[e%4*2+1]=3,e=Math.trunc(e/4),t[e%4*2]=3,e=Math.trunc(e/4),a(1,e%6,-1),e=Math.trunc(e/6),e){case 0:a(4,0,1);break;case 1:a(4,0,2);break;case 2:a(4,0,3);break;case 3:a(4,0,4);break;case 4:a(4,1,2);break;case 5:a(4,1,3);break;case 6:a(4,1,4);break;case 7:a(4,2,3);break;case 8:a(4,2,4);break;case 9:a(4,3,4);break}return r((s,o)=>{o===1?(t[s]=0,i=s):(t[s]=2,n|=1<<s)}),{pieceScheme:t,castling:n,kingFile:i}}function er(e){return{board:e.board.slice(),turn:e.turn,castling:e.castling.slice(),enPassant:e.enPassant,variant:e.variant,legal:e.legal,king:e.king.slice(),effectiveCastling:e.effectiveCastling===null?null:e.effectiveCastling.slice(),effectiveEnPassant:e.effectiveEnPassant}}var te={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(te,"__esModule",{value:!0}),te.trimAndCollapseSpaces=tr,te.isValidNag=nr,te.isValidElo=ir,te.isValidRound=rr;function tr(e){return e.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")}function nr(e){return Number.isInteger(e)&&e>=0}function ir(e){return Number.isInteger(e)&&e>=0}function rr(e){return Number.isInteger(e)&&e>=0}/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(E,"__esModule",{value:!0}),E.isColor=or,E.isPiece=lr,E.isColoredPiece=ur,E.isFile=fr,E.isRank=cr,E.isSquare=dr,E.isSquareCouple=hr,E.isCastle=_r,E.isCastle960=gr,E.isGameResult=mr,E.isGameVariant=Pr,E.forEachSquare=Nr,E.squareColor=Ir,E.squareToCoordinates=br,E.coordinatesToSquare=pr,E.oppositeColor=vr,E.variantWithCanonicalStartPosition=Er,E.nagSymbol=wr,E.isValidECO=Ar;const Se=v,O=I,ar=ee,sr=te;function or(e){return(0,O.colorFromString)(e)>=0}function lr(e){return(0,O.pieceFromString)(e)>=0}function ur(e){return(0,O.coloredPieceFromString)(e)>=0}function fr(e){return(0,O.fileFromString)(e)>=0}function cr(e){return(0,O.rankFromString)(e)>=0}function dr(e){return(0,O.squareFromString)(e)>=0}function hr(e){return typeof e=="string"&&/^[a-h][1-8][a-h][1-8]$/.test(e)}function _r(e){return typeof e=="string"&&/^[wb][kq]$/.test(e)}function gr(e){return typeof e=="string"&&/^[wb][a-h]$/.test(e)}function mr(e){return(0,O.resultFromString)(e)>=0}function Pr(e){return(0,O.variantFromString)(e)>=0}function Nr(e){for(let t=0;t<8;++t)for(let n=0;n<8;++n)e((0,O.squareToString)(t*16+n))}function Ir(e){const t=(0,O.squareFromString)(e);if(t<0)throw new Se.IllegalArgument("squareColor()");return(0,O.colorToString)((0,O.squareColorImpl)(t))}function br(e){const t=(0,O.squareFromString)(e);if(t<0)throw new Se.IllegalArgument("squareToCoordinates()");return{rank:Math.trunc(t/16),file:t%16}}function pr(e,t){const n=typeof e=="number"?e:e.file,i=typeof e=="number"?t:e.rank;if(!Number.isInteger(n)||!Number.isInteger(i)||n<0||n>=8||i<0||i>=8)throw new Se.IllegalArgument("coordinatesToSquare()");return(0,O.fileToString)(n)+(0,O.rankToString)(i)}function vr(e){const t=(0,O.colorFromString)(e);if(t<0)throw new Se.IllegalArgument("oppositeColor()");return(0,O.colorToString)(1-t)}function Er(e){const t=(0,O.variantFromString)(e);if(t<0)throw new Se.IllegalArgument("variantWithCanonicalStartPosition()");return(0,ar.hasCanonicalStartPosition)(t)}const m=new Map;m.set(1,"!"),m.set(2,"?"),m.set(3,"!!"),m.set(4,"??"),m.set(5,"!?"),m.set(6,"?!"),m.set(7,"□"),m.set(8,"□"),m.set(9,"☒"),m.set(10,"="),m.set(11,"="),m.set(13,"∞"),m.set(14,"⩲"),m.set(15,"⩱"),m.set(16,"±"),m.set(17,"∓"),m.set(18,"+−"),m.set(19,"−+"),m.set(20,"+−−"),m.set(21,"−−+"),m.set(22,"⨀"),m.set(32,"⟳"),m.set(36,"↑"),m.set(40,"→"),m.set(44,"⯹"),m.set(132,"⇆"),m.set(138,"⨁"),m.set(140,"∆"),m.set(141,"∇"),m.set(142,"⌓"),m.set(143,"≤"),m.set(145,"RR"),m.set(146,"N");function wr(e){if(!(0,sr.isValidNag)(e))throw new Se.IllegalArgument("nagSymbol()");return m.get(e)??"$"+e}function Ar(e){return typeof e=="string"&&/^[A-E][0-9][0-9]$/.test(e)}var Ce={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */var fe=ue&&ue.__classPrivateFieldSet||function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},A=ue&&ue.__classPrivateFieldGet||function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},Oe,j,B,H;Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.DateValue=void 0;const $e=v;class ne{constructor(t,n,i){if(Oe.set(this,void 0),j.set(this,void 0),B.set(this,void 0),H.set(this,void 0),t instanceof Date)fe(this,Oe,"ymd","f"),fe(this,j,t.getFullYear(),"f"),fe(this,B,t.getMonth()+1,"f"),fe(this,H,t.getDate(),"f");else{const r=fn(t,n,i);if(!r)throw new $e.IllegalArgument("DateValue()");fe(this,Oe,r,"f"),fe(this,j,t,"f"),fe(this,B,n??void 0,"f"),fe(this,H,i??void 0,"f")}}type(){return A(this,Oe,"f")}year(){return A(this,j,"f")}month(){if(A(this,B,"f")===void 0)throw new $e.IllegalArgument("DateValue.month()");return A(this,B,"f")}day(){if(A(this,H,"f")===void 0)throw new $e.IllegalArgument("DateValue.day()");return A(this,H,"f")}toDate(){const t=A(this,B,"f")===void 0?0:A(this,B,"f")-1,n=A(this,H,"f")===void 0?1:A(this,H,"f");return new Date(A(this,j,"f"),t,n)}toString(){return ln(A(this,j,"f"),A(this,B,"f"),A(this,H,"f"),"-","**")}static fromString(t){if(typeof t!="string")throw new $e.IllegalArgument("DateValue.fromString()");return un(t,/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/,/^([0-9]{4})-([0-9]{2})-\*\*$/,/^([0-9]{4})-\*\*-\*\*$/,!1)}toPGNString(){return ln(A(this,j,"f"),A(this,B,"f"),A(this,H,"f"),".","??")}static fromPGNString(t){if(typeof t!="string")throw new $e.IllegalArgument("DateValue.fromPGNString()");return un(t,/^([0-9]{4})\.([0-9]{2})\.([0-9]{2})$/,/^([0-9]{4})\.([0-9]{2})\.\?\?$/,/^([0-9]{4})(?:\.\?\?\.\?\?)?$/,!0)}toHumanReadableString(t){switch(A(this,Oe,"f")){case"ymd":{const n=new Date(A(this,j,"f"),A(this,B,"f")-1,A(this,H,"f"));return new Intl.DateTimeFormat(t,{dateStyle:"long"}).format(n)}case"ym":{const n=new Date(A(this,j,"f"),A(this,B,"f")-1,1);return new Intl.DateTimeFormat(t,{month:"long",year:"numeric"}).format(n)}default:return String(A(this,j,"f"))}}static isValid(t,n,i){return!!fn(t,n,i)}}Ce.DateValue=ne,Oe=new WeakMap,j=new WeakMap,B=new WeakMap,H=new WeakMap;function ln(e,t,n,i,r){const a=String(e).padStart(4,"0"),s=t===void 0?r:String(t).padStart(2,"0"),o=n===void 0?r:String(n).padStart(2,"0");return a+i+s+i+o}function un(e,t,n,i,r){if(t.test(e)){const a=RegExp.$1,s=RegExp.$2,o=RegExp.$3,l=parseInt(a,10),u=parseInt(s,10),f=parseInt(o,10);return ne.isValid(l,u,f)?new ne(l,u,f):r?ne.isValid(l,u)?new ne(l,u):new ne(l):void 0}else if(n.test(e)){const a=RegExp.$1,s=RegExp.$2,o=parseInt(a,10),l=parseInt(s,10);return ne.isValid(o,l)?new ne(o,l):r?new ne(o):void 0}else if(i.test(e)){const a=parseInt(RegExp.$1,10);return new ne(a)}else return}function fn(e,t,n){return n!=null?Ot(e)&&cn(t)&&Number.isInteger(n)&&n>=1&&n<=kr(e,t)?"ymd":!1:t!=null?Ot(e)&&cn(t)?"ym":!1:Ot(e)?"y":!1}function Ot(e){return Number.isInteger(e)&&e>=0}function cn(e){return Number.isInteger(e)&&e>=1&&e<=12}function kr(e,t){return new Date(e,t,0).getDate()}var Te={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(Te,"__esModule",{value:!0}),Te.MoveDescriptor=void 0,Te.isMoveDescriptor=Sr;class dn{constructor(){}toString(){let t=this.from()+this.to();return this.isPromotion()?t+=this.promotion().toUpperCase():this.isCastling()&&(t+="O"),t}}Te.MoveDescriptor=dn;function Sr(e){return e instanceof dn}var ce={},xe={};(function(e){/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(e,"__esModule",{value:!0}),e.ATTACK_DIRECTIONS=void 0,e.isAttacked=t,e.getAttacks=r,e.ATTACK_DIRECTIONS=[[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-16,-1,1,16],[-16,-1,1,16],[-17,-15,15,17],[-17,-15,15,17],[-33,-31,-18,-14,14,18,31,33],[-33,-31,-18,-14,14,18,31,33],[15,17],[-17,-15]];function t(o,l,u){return n(o,l,0*2+u)||n(o,l,4*2+u)||n(o,l,5*2+u)||i(o,l,2*2+u,1*2+u)||i(o,l,3*2+u,1*2+u)}function n(o,l,u){const f=e.ATTACK_DIRECTIONS[u];for(let d=0;d<f.length;++d){const c=l-f[d];if(!(c&136)&&o.board[c]===u)return!0}return!1}function i(o,l,u,f){const d=e.ATTACK_DIRECTIONS[u];for(let c=0;c<d.length;++c){let h=l;for(;;){if(h-=d[c],!(h&136)){const _=o.board[h];if(_===-1)continue;if(_===u||_===f)return!0}break}}return!1}function r(o,l,u){const f=[];return a(o,l,f,0*2+u),a(o,l,f,4*2+u),a(o,l,f,5*2+u),s(o,l,f,2*2+u,1*2+u),s(o,l,f,3*2+u,1*2+u),f}function a(o,l,u,f){const d=e.ATTACK_DIRECTIONS[f];for(let c=0;c<d.length;++c){const h=l-d[c];!(h&136)&&o.board[h]===f&&u.push(h)}}function s(o,l,u,f,d){const c=e.ATTACK_DIRECTIONS[f];for(let h=0;h<c.length;++h){let _=l;for(;;){if(_-=c[h],!(_&136)){const w=o.board[_];if(w===-1)continue;(w===f||w===d)&&u.push(_)}break}}}})(xe);var ge={},$={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty($,"__esModule",{value:!0}),$.isLegal=Cr,$.refreshLegalFlagAndKingSquares=lt,$.isKingSafeAfterMove=Tt,$.refreshEffectiveCastling=Mt,$.refreshEffectiveEnPassant=Ft,$.isEqual=Or;const hn=xe;function Cr(e){return lt(e),e.legal}function lt(e){if(e.legal!==null)return;e.legal=!1;const t=_n(e,0),n=_n(e,1);if(!t||!n)return;if(e.variant===5){if(!gn(e,1-e.turn))return}else if(e.variant===6&&e.turn===1&&!gn(e,0))return;if(e.king[1-e.turn]>=0&&(0,hn.isAttacked)(e,e.king[1-e.turn],e.turn))return;const i=e.variant===6?-2:10;for(let r=0;r<8;++r){const a=e.board[0+r],s=e.board[112+r];if(a===i||s===10||a===11||s===11)return}e.legal=!0}function _n(e,t){const n=0+t;if(e.king[t]=-1,e.variant===5)return!0;if(e.variant===2||e.variant===4-t||e.variant===6&&t===0){for(let i=0;i<120;i+=(i&7)===7?9:1)if(e.board[i]===n)return!1;return!0}else{for(let i=0;i<120;i+=(i&7)===7?9:1)if(e.board[i]===n)if(e.king[t]<0)e.king[t]=i;else return e.king[t]=-1,!1;return e.king[t]>=0}}function gn(e,t){for(let n=0;n<120;n+=(n&7)===7?9:1)if(e.board[n]!==-1&&e.board[n]%2===t)return!0;return!1}function Tt(e,t,n,i=-1){if(e.king[e.turn]<0)return!0;const r=e.board[t],a=e.board[n],s=Math.trunc(r/2);e.board[n]=r,e.board[t]=-1,i>=0&&(e.board[i]=-1);try{return!(0,hn.isAttacked)(e,s===0?n:e.king[e.turn],1-e.turn)}finally{e.board[t]=r,e.board[n]=a,i>=0&&(e.board[i]=5*2+1-e.turn)}}function Mt(e){e.effectiveCastling===null&&(lt(e),e.effectiveCastling=e.variant===1?[Pn(e,0),Pn(e,1)]:[mn(e,0),mn(e,1)])}function mn(e,t){const n=112*t;if(e.king[t]!==n+4||e.castling[t]===0)return 0;const i=2*2+t;let r=0;return e.castling[t]&1&&e.board[n]===i&&(r|=1),e.castling[t]&128&&e.board[n+7]===i&&(r|=128),r}function Pn(e,t){const n=112*t;if(e.king[t]<=n||e.king[t]>=n+7||e.castling[t]===0)return 0;const i=2*2+t;let r=0,a=-1;for(let o=e.king[t]%16-1;o>=0;--o)if(!(!(e.castling[t]&1<<o)||e.board[n+o]!==i))if(a<0)a=o;else{a=-1;break}a>=0&&(r|=1<<a);let s=-1;for(let o=e.king[t]%16+1;o<8;++o)if(!(!(e.castling[t]&1<<o)||e.board[n+o]!==i))if(s<0)s=o;else{s=-1;break}return s>=0&&(r|=1<<s),r}function Ft(e){if(e.effectiveEnPassant!==null||(e.effectiveEnPassant=-1,e.enPassant<0))return;const t=(6-e.turn*5)*16+e.enPassant,n=(5-e.turn*3)*16+e.enPassant,i=(4-e.turn)*16+e.enPassant,r=5*2+e.turn,a=5*2+1-e.turn;if(e.board[t]!==-1||e.board[n]!==-1||e.board[i]!==a)return;const s=(i-1&136)===0&&e.board[i-1]===r,o=(i+1&136)===0&&e.board[i+1]===r;!s&&!o||(lt(e),!(!(s&&Tt(e,i-1,n,i))&&!(o&&Tt(e,i+1,n,i)))&&(e.effectiveEnPassant=e.enPassant))}function Or(e,t){if(e.turn!==t.turn||e.variant!==t.variant)return!1;for(let n=0;n<120;n+=(n&7)===7?9:1)if(e.board[n]!==t.board[n])return!1;return Mt(e),Mt(t),e.effectiveCastling[0]!==t.effectiveCastling[0]||e.effectiveCastling[1]!==t.effectiveCastling[1]?!1:(Ft(e),Ft(t),e.effectiveEnPassant===t.effectiveEnPassant)}/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(ge,"__esModule",{value:!0}),ge.ascii=Mr,ge.getFEN=Fr,ge.parseFEN=Vr;const ie=I,Tr=ee,Vt=$,J=v,X=K,Lt=[..."KkQqRrBbNnPp"],Nn=["6","3"];function Mr(e){let t=`+---+---+---+---+---+---+---+---+
`;for(let n=7;n>=0;--n){for(let i=0;i<8;++i){const r=e.board[n*16+i];t+="| "+(r===-1?" ":Lt[r])+" "}t+=`|
`,t+=`+---+---+---+---+---+---+---+---+
`}return t+=(0,ie.colorToString)(e.turn)+" "+In(e)+" "+pn(e),e.variant!==0&&(t+=" ("+(0,ie.variantToString)(e.variant)+")"),t}function Fr(e,t=0,n=1,i=!1){let r="";for(let a=7;a>=0;--a){let s=0;for(let o=0;o<8;++o){const l=e.board[a*16+o];l===-1?++s:(s>0&&(r+=s,s=0),r+=Lt[l])}s>0&&(r+=s),a>0&&(r+="/")}return r+=" "+(0,ie.colorToString)(e.turn)+" "+In(e,i)+" "+pn(e),r+=" "+t+" "+n,r}function In(e,t=!1){if((0,Vt.refreshEffectiveCastling)(e),e.variant===1){if(t){const r=bn(e,0),a=bn(e,1);if(r!==!1&&a!==!1)return r===""&&a===""?"-":r.toUpperCase()+a}let n="",i="";for(let r=0;r<8;++r)e.effectiveCastling[0]&1<<r&&(n+=(0,ie.fileToString)(r)),e.effectiveCastling[1]&1<<r&&(i+=(0,ie.fileToString)(r));return n===""&&i===""?"-":n.toUpperCase()+i}else{let n="";return e.effectiveCastling[0]&128&&(n+="K"),e.effectiveCastling[0]&1&&(n+="Q"),e.effectiveCastling[1]&128&&(n+="k"),e.effectiveCastling[1]&1&&(n+="q"),n===""?"-":n}}function bn(e,t){const n=1<<e.king[t]%16,i=e.effectiveCastling[t]&~(n|n-1),r=e.effectiveCastling[t]&n-1;let a="";const s=112*t,o=112*t+7,l=2*2+t;if(i!==0){let u=!1;for(let f=e.king[t]+1;f<=o;++f)if(e.board[f]===l){if(u)return!1;u=!0}a+="k"}if(r!==0){let u=!1;for(let f=e.king[t]-1;f>=s;--f)if(e.board[f]===l){if(u)return!1;u=!0}a+="q"}return a}function pn(e){return(0,Vt.refreshEffectiveEnPassant)(e),e.effectiveEnPassant<0?"-":(0,ie.fileToString)(e.effectiveEnPassant)+Nn[e.turn]}function Vr(e,t,n){const i=n?t.split(" "):t.replace(/^\s+|\s+$/g,"").split(/\s+/);if(i.length!==6)throw new J.InvalidFEN(t,X.i18n.WRONG_NUMBER_OF_FEN_FIELDS);const r=i[0].split("/");if(r.length!==8)throw new J.InvalidFEN(t,X.i18n.WRONG_NUMBER_OF_SUBFIELDS_IN_BOARD_FIELD);const a=(0,Tr.makeEmpty)(e);a.legal=null,a.effectiveCastling=null,a.effectiveEnPassant=null;for(let u=7;u>=0;--u){const f=r[7-u];let d=0,c=0;for(;d<f.length&&c<8;){const h=f[d],_=Lt.indexOf(h);if(/^[1-8]$/.test(h))c+=parseInt(h,10);else if(_>=0)a.board[u*16+c]=_,++c;else throw new J.InvalidFEN(t,X.i18n.UNEXPECTED_CHARACTER_IN_BOARD_FIELD,h);++d}if(d!==f.length||c!==8)throw new J.InvalidFEN(t,X.i18n.UNEXPECTED_END_OF_SUBFIELD_IN_BOARD_FIELD,8-u)}if(a.turn=(0,ie.colorFromString)(i[1]),a.turn<0)throw new J.InvalidFEN(t,X.i18n.INVALID_TURN_FIELD);const s=e===1?Rr(i[2],n,a.board):Lr(i[2],n);if(s===null)throw new J.InvalidFEN(t,X.i18n.INVALID_CASTLING_FIELD);a.castling=s;const o=i[3];if(o!=="-"){if(!/^[a-h][36]$/.test(o))throw new J.InvalidFEN(t,X.i18n.INVALID_EN_PASSANT_FIELD);if(a.enPassant=(0,ie.fileFromString)(o[0]),n){if(o[1]!==Nn[a.turn])throw new J.InvalidFEN(t,X.i18n.WRONG_RANK_IN_EN_PASSANT_FIELD);if((0,Vt.refreshEffectiveEnPassant)(a),a.enPassant!==a.effectiveEnPassant)throw new J.InvalidFEN(t,X.i18n.INEFFECTIVE_EN_PASSANT_FIELD,(0,ie.fileToString)(a.enPassant))}}const l=n?/^(?:0|[1-9][0-9]*)$/:/^[0-9]+$/;if(!l.test(i[4]))throw new J.InvalidFEN(t,X.i18n.INVALID_HALF_MOVE_COUNT_FIELD);if(!l.test(i[5]))throw new J.InvalidFEN(t,X.i18n.INVALID_MOVE_NUMBER_FIELD);return{position:a,fiftyMoveClock:parseInt(i[4],10),fullMoveNumber:parseInt(i[5],10)}}function Lr(e,t){const n=[0,0];return e==="-"?n:(t?/^K?Q?k?q?$/:/^[KQkq]*$/).test(e)?(e.indexOf("K")>=0&&(n[0]|=128),e.indexOf("Q")>=0&&(n[0]|=1),e.indexOf("k")>=0&&(n[1]|=128),e.indexOf("q")>=0&&(n[1]|=1),n):null}function Rr(e,t,n){const i=[0,0];if(e==="-")return i;if(!(t?/^[A-H]{0,2}[a-h]{0,2}$/:/^[A-Ha-h]*|[KQkq]*$/).test(e))return null;function r(s){const o=4+s,l=0*2+s;for(let u=112*s;u<112*s+8;++u){if(n[u]===o)return u%8;if(n[u]===l)break}return 0}function a(s){const o=4+s,l=0*2+s;for(let u=112*s+7;u>=112*s;--u){if(n[u]===o)return u%8;if(n[u]===l)break}return 7}t||(e.indexOf("K")>=0&&(i[0]|=1<<a(0)),e.indexOf("Q")>=0&&(i[0]|=1<<r(0)),e.indexOf("k")>=0&&(i[1]|=1<<a(1)),e.indexOf("q")>=0&&(i[1]|=1<<r(1)));for(let s=0;s<8;++s){const o=(0,ie.fileToString)(s);e.indexOf(o.toUpperCase())>=0&&(i[0]|=1<<s),e.indexOf(o)>=0&&(i[1]|=1<<s)}return i}var Me={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(Me,"__esModule",{value:!0}),Me.MoveDescriptorImpl=void 0;const x=I,me=v,yr=Te,vn=1,En=2,ut=4,wn=8;class Fe extends yr.MoveDescriptor{static make(t,n,i,r){const a=r===-1?0:ut;return new Fe(a,t,n,i,i,r,-1,-1)}static makeCastling(t,n,i,r,a){const s=0+a,o=2*2+a;return new Fe(vn,t,n,s,s,o,i,r)}static makeEnPassant(t,n,i,r){const a=En|ut,s=5*2+r,o=5*2+1-r;return new Fe(a,t,n,s,s,o,i,-1)}static makePromotion(t,n,i,r,a){const s=wn|(r===-1?0:ut),o=5*2+i,l=a*2+i;return new Fe(s,t,n,o,l,r,-1,-1)}constructor(t,n,i,r,a,s,o,l){super(),this._flags=t,this._from=n,this._to=i,this._movingColoredPiece=r,this._finalColoredPiece=a,this._optionalColoredPiece=s,this._optionalSquare1=o,this._optionalSquare2=l}isCastling(){return(this._flags&vn)!==0}isEnPassant(){return(this._flags&En)!==0}isCapture(){return(this._flags&ut)!==0}isPromotion(){return(this._flags&wn)!==0}from(){return(0,x.squareToString)(this._from)}to(){return(0,x.squareToString)(this._to)}color(){return(0,x.colorToString)(this._movingColoredPiece%2)}movingPiece(){return(0,x.pieceToString)(Math.trunc(this._movingColoredPiece/2))}movingColoredPiece(){return(0,x.coloredPieceToString)(this._movingColoredPiece)}capturedPiece(){if(!this.isCapture())throw new me.IllegalArgument("MoveDescriptor.capturedPiece()");return(0,x.pieceToString)(Math.trunc(this._optionalColoredPiece/2))}capturedColoredPiece(){if(!this.isCapture())throw new me.IllegalArgument("MoveDescriptor.capturedColoredPiece()");return(0,x.coloredPieceToString)(this._optionalColoredPiece)}rookFrom(){if(!this.isCastling())throw new me.IllegalArgument("MoveDescriptor.rookFrom()");return(0,x.squareToString)(this._optionalSquare1)}rookTo(){if(!this.isCastling())throw new me.IllegalArgument("MoveDescriptor.rookTo()");return(0,x.squareToString)(this._optionalSquare2)}enPassantSquare(){if(!this.isEnPassant())throw new me.IllegalArgument("MoveDescriptor.enPassantSquare()");return(0,x.squareToString)(this._optionalSquare1)}promotion(){if(!this.isPromotion())throw new me.IllegalArgument("MoveDescriptor.promotion()");return(0,x.pieceToString)(Math.trunc(this._finalColoredPiece/2))}coloredPromotion(){if(!this.isPromotion())throw new me.IllegalArgument("MoveDescriptor.coloredPromotion()");return(0,x.coloredPieceToString)(this._finalColoredPiece)}}Me.MoveDescriptorImpl=Fe;var V={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(V,"__esModule",{value:!0}),V.isCheck=qr,V.isCheckmate=Kr,V.isStalemate=Br,V.isDead=$r,V.hasMove=Rt,V.moves=Qr,V.isCaptureMandatory=yt,V.isCastlingMoveLegal=On,V.isMoveLegal=Wr,V.play=Hr,V.isNullMoveLegal=Mn,V.playNullMove=Jr;const Ve=xe,An=I,k=$,L=Me,Dr=[204,0,0,0,0,0,0,60,0,0,0,0,0,0,204,0,0,204,0,0,0,0,0,60,0,0,0,0,0,204,0,0,0,0,204,0,0,0,0,60,0,0,0,0,204,0,0,0,0,0,0,204,0,0,0,60,0,0,0,204,0,0,0,0,0,0,0,0,204,0,0,60,0,0,204,0,0,0,0,0,0,0,0,0,0,204,768,60,768,204,0,0,0,0,0,0,0,0,0,0,0,768,2255,2111,2255,768,0,0,0,0,0,0,60,60,60,60,60,60,63,0,63,60,60,60,60,60,60,0,0,0,0,0,0,768,1231,1087,1231,768,0,0,0,0,0,0,0,0,0,0,0,204,768,60,768,204,0,0,0,0,0,0,0,0,0,0,204,0,0,60,0,0,204,0,0,0,0,0,0,0,0,204,0,0,0,60,0,0,0,204,0,0,0,0,0,0,204,0,0,0,0,60,0,0,0,0,204,0,0,0,0,204,0,0,0,0,0,60,0,0,0,0,0,204,0,0,204,0,0,0,0,0,0,60,0,0,0,0,0,0,204,0],Gr=[-17,0,0,0,0,0,0,-16,0,0,0,0,0,0,-15,0,0,-17,0,0,0,0,0,-16,0,0,0,0,0,-15,0,0,0,0,-17,0,0,0,0,-16,0,0,0,0,-15,0,0,0,0,0,0,-17,0,0,0,-16,0,0,0,-15,0,0,0,0,0,0,0,0,-17,0,0,-16,0,0,-15,0,0,0,0,0,0,0,0,0,0,-17,0,-16,0,-15,0,0,0,0,0,0,0,0,0,0,0,0,-17,-16,-15,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,15,16,17,0,0,0,0,0,0,0,0,0,0,0,0,15,0,16,0,17,0,0,0,0,0,0,0,0,0,0,15,0,0,16,0,0,17,0,0,0,0,0,0,0,0,15,0,0,0,16,0,0,0,17,0,0,0,0,0,0,15,0,0,0,0,16,0,0,0,0,17,0,0,0,0,15,0,0,0,0,0,16,0,0,0,0,0,17,0,0,15,0,0,0,0,0,0,16,0,0,0,0,0,0,17,0];function kn(e,t){for(let n=0;n<120;n+=(n&7)===7?9:1)if(e.board[n]!==-1&&e.board[n]%2===t)return!0;return!1}function ft(e){return e.king[e.turn]>=0&&(0,Ve.isAttacked)(e,e.king[e.turn],1-e.turn)}function qr(e){return(0,k.isLegal)(e)&&ft(e)}function Kr(e){return!(0,k.isLegal)(e)||Rt(e)?!1:e.variant===5?!0:e.variant===6&&e.turn===0?!kn(e,0):ft(e)}function Br(e){return!(0,k.isLegal)(e)||Rt(e)?!1:e.variant===5?!0:e.variant===6&&e.turn===0?kn(e,0):!ft(e)}function $r(e,t){return(0,k.isLegal)(e)&&(e.variant===0||e.variant===1)?t?Ur(e):xr(e):!1}function xr(e){let t=!1,n=-1;for(let i=0;i<120;i+=(i&7)===7?9:1){const r=e.board[i];if(r===-1)continue;const a=Math.trunc(r/2);if(a===3){const s=(0,An.squareColorImpl)(i);if(n===s)continue;n=s}if(a===3||a===4){if(t)return!1;t=!0}else if(a!==0)return!1}return!0}function Ur(e){const t=[0,0],n=[-1,-1];for(let i=0;i<120;i+=(i&7)===7?9:1){const r=e.board[i];if(r===-1)continue;const a=r%2,s=Math.trunc(r/2);if(s===3){const o=(0,An.squareColorImpl)(i);if(n[a]===o)continue;n[a]=o}if(s===3||s===4){if(t[a]+=s===3?2:1,t[a]>=3)return!1}else if(s!==0)return!1}return!0}function Rt(e){class t{}try{return Sn(e,()=>{throw new t}),!1}catch(n){if(n instanceof t)return!0;throw n}}function Qr(e){const t=[];return Sn(e,n=>{t.push(n)}),t}function Sn(e,t){if(!(0,k.isLegal)(e))return;const n=!yt(e);if((0,k.refreshEffectiveCastling)(e),n&&e.effectiveCastling[e.turn]!==0){const i=112*e.turn;for(let r=0;r<8;++r)if(e.effectiveCastling[e.turn]&1<<r){const a=i+r,s=i+(a<e.king[e.turn]?3:5),o=i+(a<e.king[e.turn]?2:6);Tn(e,e.king[e.turn],o,a,s)&&t(L.MoveDescriptorImpl.makeCastling(e.king[e.turn],o,a,s,e.turn))}}if((0,k.refreshEffectiveEnPassant)(e),e.effectiveEnPassant>=0){const i=(5-e.turn*3)*16+e.effectiveEnPassant,r=(4-e.turn)*16+e.effectiveEnPassant,a=5*2+e.turn;!(r-1&136)&&e.board[r-1]===a&&(0,k.isKingSafeAfterMove)(e,r-1,i,r)&&t(L.MoveDescriptorImpl.makeEnPassant(r-1,i,r,e.turn)),!(r+1&136)&&e.board[r+1]===a&&(0,k.isKingSafeAfterMove)(e,r+1,i,r)&&t(L.MoveDescriptorImpl.makeEnPassant(r+1,i,r,e.turn))}for(let i=0;i<120;i+=(i&7)===7?9:1){const r=e.board[i],a=Math.trunc(r/2);if(!(r===-1||r%2!==e.turn))if(a===5){const s=Ve.ATTACK_DIRECTIONS[r];for(let o=0;o<s.length;++o){const l=i+s[o];!(l&136)&&e.board[l]!==-1&&e.board[l]%2!==e.turn&&(0,k.isKingSafeAfterMove)(e,i,l)&&Cn(e,i,l,t)}if(n){const o=16-e.turn*32;let l=i+o;if(e.board[l]===-1){(0,k.isKingSafeAfterMove)(e,i,l)&&Cn(e,i,l,t);const u=e.turn*96;i>=u&&i<u+24&&(l+=o,e.board[l]===-1&&(0,k.isKingSafeAfterMove)(e,i,l)&&t(L.MoveDescriptorImpl.make(i,l,r,-1)))}}}else if(a===4||a===0){const s=Ve.ATTACK_DIRECTIONS[r];for(let o=0;o<s.length;++o){const l=i+s[o];if(!(l&136)){const u=e.board[l];(u===-1?n:u%2!==e.turn)&&(0,k.isKingSafeAfterMove)(e,i,l)&&t(L.MoveDescriptorImpl.make(i,l,r,u))}}}else{const s=Ve.ATTACK_DIRECTIONS[r];for(let o=0;o<s.length;++o)for(let l=i+s[o];!(l&136);l+=s[o]){const u=e.board[l];if((u===-1?n:u%2!==e.turn)&&(0,k.isKingSafeAfterMove)(e,i,l)&&t(L.MoveDescriptorImpl.make(i,l,r,u)),u!==-1)break}}}}function Cn(e,t,n,i){const r=e.board[n];n<8||n>=112?(i(L.MoveDescriptorImpl.makePromotion(t,n,e.turn,r,1)),i(L.MoveDescriptorImpl.makePromotion(t,n,e.turn,r,2)),i(L.MoveDescriptorImpl.makePromotion(t,n,e.turn,r,3)),i(L.MoveDescriptorImpl.makePromotion(t,n,e.turn,r,4)),e.variant===5&&i(L.MoveDescriptorImpl.makePromotion(t,n,e.turn,r,0))):i(L.MoveDescriptorImpl.make(t,n,5*2+e.turn,r))}function yt(e){if(e.variant!==5)return!1;for(let t=0;t<120;t+=(t&7)===7?9:1){const n=e.board[t];if(n!==-1&&n%2!==e.turn&&(0,Ve.isAttacked)(e,t,e.turn))return!0}return(0,k.refreshEffectiveEnPassant)(e),e.effectiveEnPassant>=0}function On(e,t,n){let i=-1,r=-1;if(e.variant===1){const a=n%16;if(Math.trunc(n/16)!==e.turn*7||!(e.effectiveCastling[e.turn]&1<<a))return!1;i=n,r=(t>n?3:5)+112*e.turn,n=(t>n?2:6)+112*e.turn}else if(n===2+e.turn*112){if(!(e.effectiveCastling[e.turn]&1))return!1;i=112*e.turn,r=3+112*e.turn}else if(n===6+e.turn*112){if(!(e.effectiveCastling[e.turn]&128))return!1;i=7+112*e.turn,r=5+112*e.turn}else return!1;return Tn(e,t,n,i,r)?L.MoveDescriptorImpl.makeCastling(t,n,i,r,e.turn):!1}function Tn(e,t,n,i,r){e.board[t]=-1,e.board[i]=-1;try{for(let s=Math.min(t,n,i,r);s<=Math.max(t,n,i,r);++s)if(e.board[s]!==-1)return!1;const a=1-e.turn;for(let s=Math.min(t,n);s<=Math.max(t,n);++s)if((0,Ve.isAttacked)(e,s,a))return!1;return!0}finally{e.board[t]=0*2+e.turn,e.board[i]=2*2+e.turn}}function Wr(e,t,n){if(!(0,k.isLegal)(e))return!1;const i=e.board[t],r=e.board[n],a=Math.trunc(i/2);if(i===-1||i%2!==e.turn)return!1;const s=n-t+119;let o=-1,l=!1;const u=a===5&&(n<8||n>=112),f=yt(e);if(a===0&&!f&&((0,k.refreshEffectiveCastling)(e),e.effectiveCastling[e.turn]!==0)){const d=On(e,t,n);if(d)return{type:"regular",moveDescriptor:d}}if(!(Dr[s]&1<<i))if(a===5&&s===151-e.turn*64){const d=e.turn*96;if(t<d||t>=d+24)return!1;l=!0}else return!1;if(a===5){if((0,k.refreshEffectiveEnPassant)(e),s===135-e.turn*32||l){if(f||r!==-1)return!1}else if(r===-1){if(n!==(5-e.turn*3)*16+e.effectiveEnPassant)return!1;o=(4-e.turn)*16+e.effectiveEnPassant}else if(r%2===e.turn)return!1}else if(r===-1?f:r%2===e.turn)return!1;if(a===3||a===2||a===1){const d=Gr[s];for(let c=t+d;c!==n;c+=d)if(e.board[c]!==-1)return!1}else if(l&&e.board[(t+n)/2]!==-1)return!1;return(0,k.isKingSafeAfterMove)(e,t,n,o)?u?{type:"promotion",moveDescriptorFactory:jr(t,n,e.variant,e.turn,r)}:{type:"regular",moveDescriptor:o>=0?L.MoveDescriptorImpl.makeEnPassant(t,n,o,e.turn):L.MoveDescriptorImpl.make(t,n,i,r)}:!1}function jr(e,t,n,i,r){return a=>a===5||a===0&&n!==5?!1:L.MoveDescriptorImpl.makePromotion(e,t,i,r,a)}function Hr(e,t){(0,k.refreshEffectiveCastling)(e),e.board[t._from]=-1,t.isEnPassant()?e.board[t._optionalSquare1]=-1:t.isCastling()&&(e.board[t._optionalSquare1]=-1,e.board[t._optionalSquare2]=t._optionalColoredPiece),e.board[t._to]=t._finalColoredPiece;const n=Math.trunc(t._movingColoredPiece/2);if(n===0&&(e.effectiveCastling[e.turn]=0),t._from<8&&(e.effectiveCastling[0]&=~(1<<t._from)),t._to<8&&(e.effectiveCastling[0]&=~(1<<t._to)),t._from>=112&&(e.effectiveCastling[1]&=~(1<<t._from%16)),t._to>=112&&(e.effectiveCastling[1]&=~(1<<t._to%16)),e.castling[0]=e.effectiveCastling[0],e.castling[1]=e.effectiveCastling[1],e.enPassant=-1,e.effectiveEnPassant=-1,n===5&&Math.abs(t._from-t._to)===32){const i=(1+5*e.turn)*16;if(t._from>=i&&t._from<i+8){const r=t._movingColoredPiece^1;(!(t._to-1&136)&&e.board[t._to-1]===r||!(t._to+1&136)&&e.board[t._to+1]===r)&&(e.enPassant=t._to%16,e.effectiveEnPassant=null)}}n===0&&e.king[e.turn]>=0&&(e.king[e.turn]=t._to),e.turn=1-e.turn}function Mn(e){return(0,k.isLegal)(e)&&!ft(e)}function Jr(e){return Mn(e)?(e.turn=1-e.turn,e.enPassant=-1,e.effectiveEnPassant=-1,!0):!1}var ct={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(ct,"__esModule",{value:!0}),ct.getNotation=Yr,ct.parseNotation=Zr;const Fn=xe,R=I,P=ge,Xr=ee,Ue=$,dt=Me,Le=V,N=v,g=K;function Yr(e,t,n){let i="";return t.isCastling()?i=t._to%16===6?"O-O":"O-O-O":Math.trunc(t._movingColoredPiece/2)===5?(t.isCapture()&&(i+=(0,R.fileToString)(t._from%16)+"x"),i+=(0,R.squareToString)(t._to),t.isPromotion()&&(i+="="+Vn(t._finalColoredPiece,n))):(i+=Vn(t._movingColoredPiece,n),i+=Rn(e,t._from,t._to),t.isCapture()&&(i+="x"),i+=(0,R.squareToString)(t._to)),i+=Ln(e,t),i}function Vn(e,t){switch(t){case"figurine":return(0,R.figurineToString)(e);case"standard":return(0,R.pieceToString)(Math.trunc(e/2)).toUpperCase()}}function Ln(e,t){const n=(0,Xr.makeCopy)(e);return(0,Le.play)(n,t),(0,Le.isCheckmate)(n)?"#":(0,Le.isCheck)(n)?"+":""}function Rn(e,t,n){const i=(0,Fn.getAttacks)(e,n,e.turn).filter(u=>e.board[u]===e.board[t]);if(i.length<2)return"";let r=!1,a=!1,s=!1;const o=Math.trunc(t/16),l=t%16;for(let u=0;u<i.length;++u){const f=i[u];f===t||zr(e,f,n)||(r=!0,o===Math.trunc(f/16)&&(a=!0),l===f%16&&(s=!0))}return s?a?(0,R.squareToString)(t):(0,R.rankToString)(o):r?(0,R.fileToString)(l):""}function zr(e,t,n){const i=e.king[e.turn];if(i<0)return!1;const r=Math.abs(i-t),a=Math.abs(n-t),s=1*2+1-e.turn,o=2*2+1-e.turn,l=3*2+1-e.turn;return r<8?a>=8&&ht(e,i,t,i<t?1:-1,o,s):r%16===0?a%16!==0&&ht(e,i,t,i<t?16:-16,o,s):r%15===0?a%15!==0&&ht(e,i,t,i<t?15:-15,l,s):r%17===0?a%17!==0&&ht(e,i,t,i<t?17:-17,l,s):!1}function ht(e,t,n,i,r,a){for(let s=t+i;s!==n;s+=i)if(e.board[s]!==-1)return!1;for(let s=n+i;!(s&136);s+=i)if(e.board[s]!==-1)return e.board[s]===r||e.board[s]===a;return!1}function Zr(e,t,n,i){const r=/^(?:(O-O-O|0-0-0)|(O-O|0-0)|([A-Z\u2654-\u265f])([a-h])?([1-8])?(x)?([a-h][1-8])|(?:([a-h])(x)?)?([a-h][1-8])(?:(=)?([A-Z\u2654-\u265f]))?)([+#])?$/.exec(t);if(r===null)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_MOVE_NOTATION_SYNTAX);if(!(0,Ue.isLegal)(e))throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.ILLEGAL_POSITION);let a=!1;if(r[1]!==void 0||r[2]!==void 0?a=ea(e,t,n,r[1],r[2]):r[3]!==void 0?a=na(e,t,n,i,r[3],r[4],r[5],r[7]):a=ia(e,t,n,i,r[8],r[10],r[11],r[12]),n){const s=r[6]!==void 0||r[9]!==void 0;if(a.isCapture()!==s){const u=a.isCapture()?g.i18n.MISSING_CAPTURE_SYMBOL:g.i18n.INVALID_CAPTURE_SYMBOL;throw new N.InvalidNotation((0,P.getFEN)(e),t,u)}const o=Ln(e,a),l=r[13]??"";if(o!==l)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.WRONG_CHECK_CHECKMATE_SYMBOL,o,l)}return a}function ea(e,t,n,i,r){const a=e.king[e.turn];if(a<0)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.ILLEGAL_NO_KING_CASTLING);(0,Ue.refreshEffectiveCastling)(e);const s=r!==void 0,o=ta(e,s),l=o>=0?(0,Le.isCastlingMoveLegal)(e,a,o+112*e.turn):!1;if(!l){const u=s?g.i18n.ILLEGAL_KING_SIDE_CASTLING:g.i18n.ILLEGAL_QUEEN_SIDE_CASTLING;throw new N.InvalidNotation((0,P.getFEN)(e),t,u)}if(n&&(s?r:i).charAt(0)==="0")throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.CASTLING_MOVE_ENCODED_WITH_ZERO);return l}function ta(e,t){if(e.variant===1){if(e.effectiveCastling[e.turn]!==0){const n=0+e.turn;for(let i=t?7:0;e.board[i+112*e.turn]!==n;i+=t?-1:1)if(e.effectiveCastling[e.turn]&1<<i)return i}return-1}else return t?6:2}function na(e,t,n,i,r,a,s,o){const l=yn(e,t,r,n,i)*2+e.turn,u=(0,R.squareFromString)(o),f=e.board[u];if(f!==-1&&f%2===e.turn)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.TRYING_TO_CAPTURE_YOUR_OWN_PIECES);if(f===-1&&(0,Le.isCaptureMandatory)(e))throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.CAPTURE_IS_MANDATORY);let d=(0,Fn.getAttacks)(e,u,e.turn).filter(h=>e.board[h]===l);if(a!==void 0){const h=(0,R.fileFromString)(a);d=d.filter(_=>_%16===h)}if(s!==void 0){const h=(0,R.rankFromString)(s);d=d.filter(_=>Math.trunc(_/16)===h)}if(d.length===0){const h=a===void 0&&s===void 0?g.i18n.NO_PIECE_CAN_MOVE_TO:g.i18n.NO_PIECE_CAN_MOVE_TO_DISAMBIGUATION;throw new N.InvalidNotation((0,P.getFEN)(e),t,h,r,o)}let c=!1;for(let h=0;h<d.length;++h)if((0,Ue.isKingSafeAfterMove)(e,d[h],u)){if(c)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.REQUIRE_DISAMBIGUATION,r,o);c=dt.MoveDescriptorImpl.make(d[h],u,l,f)}if(!c){const h=e.turn===0?g.i18n.NOT_SAFE_FOR_WHITE_KING:g.i18n.NOT_SAFE_FOR_BLACK_KING;throw new N.InvalidNotation((0,P.getFEN)(e),t,h)}if(n){const h=Rn(e,c._from,u),_=(a??"")+(s??"");if(h!==_)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.WRONG_DISAMBIGUATION_SYMBOL,h,_)}return c}function ia(e,t,n,i,r,a,s,o){const l=10+e.turn,u=(0,R.squareFromString)(a),f=e.board[u],d=16-e.turn*32;let c=u-d,h=-1;if(r!==void 0){if(c&136)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_CAPTURING_PAWN_MOVE);const _=(0,R.fileFromString)(r),w=u%16;if(w-_===1)c-=1;else if(w-_===-1)c+=1;else throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_CAPTURING_PAWN_MOVE);if(e.board[c]!==l)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_CAPTURING_PAWN_MOVE);if(f===-1){if((0,Ue.refreshEffectiveEnPassant)(e),u!==(5-e.turn*3)*16+e.effectiveEnPassant)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_CAPTURING_PAWN_MOVE);h=(4-e.turn)*16+e.effectiveEnPassant}else if(f%2===e.turn)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_CAPTURING_PAWN_MOVE)}else{if((0,Le.isCaptureMandatory)(e))throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.CAPTURE_IS_MANDATORY);if(c&136)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_NON_CAPTURING_PAWN_MOVE);if(f!==-1)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_NON_CAPTURING_PAWN_MOVE);if(e.board[c]===-1){c-=d;const _=e.turn*96;if(c<_||c>=_+24||e.board[c]!==l)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_NON_CAPTURING_PAWN_MOVE)}else if(e.board[c]!==l)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_NON_CAPTURING_PAWN_MOVE)}if(!(0,Ue.isKingSafeAfterMove)(e,c,u,h)){const _=e.turn===0?g.i18n.NOT_SAFE_FOR_WHITE_KING:g.i18n.NOT_SAFE_FOR_BLACK_KING;throw new N.InvalidNotation((0,P.getFEN)(e),t,_)}if(u<8||u>=112){if(o===void 0)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.MISSING_PROMOTION);const _=yn(e,t,o,n,i);if(_===5||_===0&&e.variant!==5)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_PROMOTED_PIECE,o);if(n&&s===void 0)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.MISSING_PROMOTION_SYMBOL);return dt.MoveDescriptorImpl.makePromotion(c,u,e.turn,f,_)}else{if(o!==void 0)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.ILLEGAL_PROMOTION);return h>=0?dt.MoveDescriptorImpl.makeEnPassant(c,u,h,e.turn):dt.MoveDescriptorImpl.make(c,u,l,f)}}function yn(e,t,n,i,r){switch(r){case"figurine":{const a=(0,R.figurineFromString)(n);if(a<0)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_PIECE_SYMBOL,n);if(i&&a%2!==e.turn)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_PIECE_SYMBOL_COLOR,n);return Math.trunc(a/2)}case"standard":{const a=(0,R.pieceFromString)(n.toLowerCase());if(a<0)throw new N.InvalidNotation((0,P.getFEN)(e),t,g.i18n.INVALID_PIECE_SYMBOL,n);return a}}}var _t={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(_t,"__esModule",{value:!0}),_t.getUCINotation=sa,_t.parseUCINotation=oa;const Dt=I,Pe=ge,ra=$,aa=V,Ne=v,Ie=K;function sa(e,t,n){let i=t.from();return t.isCastling()?i+=n||e.variant===1?t.rookFrom():t.to():i+=t.to(),t.isPromotion()&&(i+=t.promotion()),i}function oa(e,t,n){const i=/^([a-h][1-8])([a-h][1-8])([kqrbnp]?)$/.exec(t);if(i===null)throw new Ne.InvalidNotation((0,Pe.getFEN)(e),t,Ie.i18n.INVALID_UCI_NOTATION_SYNTAX);if(!(0,ra.isLegal)(e))throw new Ne.InvalidNotation((0,Pe.getFEN)(e),t,Ie.i18n.ILLEGAL_POSITION);const r=(0,Dt.squareFromString)(i[1]);let a=(0,Dt.squareFromString)(i[2]),s=!1,o=-1;if(e.variant!==1&&!n&&e.board[r]!==-1&&e.board[a]!==-1&&e.board[r]%2===e.board[a]%2){const f=Math.trunc(e.board[r]/2),d=Math.trunc(e.board[a]/2);f===0&&d===2&&(s=!0,o=a,a=e.turn*112+(r<a?6:2))}const l=(0,aa.isMoveLegal)(e,r,a);let u=!1;if(!l)throw new Ne.InvalidNotation((0,Pe.getFEN)(e),t,Ie.i18n.ILLEGAL_UCI_MOVE);if(l.type==="promotion"){if(i[3]==="")throw new Ne.InvalidNotation((0,Pe.getFEN)(e),t,Ie.i18n.ILLEGAL_UCI_MOVE);if(u=l.moveDescriptorFactory((0,Dt.pieceFromString)(i[3])),!u)throw new Ne.InvalidNotation((0,Pe.getFEN)(e),t,Ie.i18n.ILLEGAL_UCI_MOVE)}else{if(i[3]!=="")throw new Ne.InvalidNotation((0,Pe.getFEN)(e),t,Ie.i18n.ILLEGAL_UCI_MOVE);u=l.moveDescriptor}if(s&&(!u.isCastling()||o!==u._optionalSquare1))throw new Ne.InvalidNotation((0,Pe.getFEN)(e),t,Ie.i18n.ILLEGAL_UCI_MOVE);return u}/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(ce,"__esModule",{value:!0}),ce.Position=void 0;const b=v,gt=E,la=K,Dn=xe,p=I,de=ge,y=ee,Qe=$,We=Me,Y=V,be=ct,mt=_t;class je{constructor(t,n){switch(arguments.length){case 0:this._impl=(0,y.makeInitial)(0);break;case 1:{if(t==="start")this._impl=(0,y.makeInitial)(0);else if(t==="empty")this._impl=(0,y.makeEmpty)(0);else if(t instanceof je)this._impl=(0,y.makeCopy)(t._impl);else{const i=(0,p.variantFromString)(t);if(i>=0){if(!(0,y.hasCanonicalStartPosition)(i))throw new b.IllegalArgument("Position()");this._impl=(0,y.makeInitial)(i)}else if(typeof t=="string"){const r=t.indexOf(":");if(r<0)this._impl=(0,de.parseFEN)(0,t,!1).position;else{const a=t.substring(0,r),s=(0,p.variantFromString)(a);if(s<0)throw new b.InvalidFEN(t,la.i18n.INVALID_VARIANT_PREFIX,a);this._impl=(0,de.parseFEN)(s,t.substring(r+1),!1).position}}else throw new b.IllegalArgument("Position()")}break}default:{const i=(0,p.variantFromString)(t);if(i<0)throw new b.IllegalArgument("Position()");if(n==="start"){if(!(0,y.hasCanonicalStartPosition)(i))throw new b.IllegalArgument("Position()");this._impl=(0,y.makeInitial)(i)}else if(n==="empty")this._impl=(0,y.makeEmpty)(i);else if(typeof n=="number"){if(i!==1||!Gn(n))throw new b.IllegalArgument("Position()");this._impl=(0,y.make960FromScharnagl)(n)}else if(typeof n=="string")this._impl=(0,de.parseFEN)(i,n,!1).position;else throw new b.IllegalArgument("Position()");break}}}clear(t="regular"){const n=(0,p.variantFromString)(t);if(n<0)throw new b.IllegalArgument("Position.clear()");this._impl=(0,y.makeEmpty)(n)}reset(){this._impl=(0,y.makeInitial)(0)}reset960(t){if(!Gn(t))throw new b.IllegalArgument("Position.reset960()");this._impl=(0,y.make960FromScharnagl)(t)}resetAntichess(){this._impl=(0,y.makeInitial)(5)}resetHorde(){this._impl=(0,y.makeInitial)(6)}static isEqual(t,n){return t instanceof je&&n instanceof je&&(0,Qe.isEqual)(t._impl,n._impl)}ascii(){return(0,de.ascii)(this._impl)}fen(t,n){if(arguments.length===0)return(0,de.getFEN)(this._impl);if(arguments.length===1&&typeof t=="object"){const i=ua(t,"Position.fen()"),r=i("fiftyMoveClock",0,l=>Number.isInteger(l)),a=i("fullMoveNumber",1,l=>Number.isInteger(l)),s=i("withVariant",!1,l=>typeof l=="boolean"),o=i("regularFENIfPossible",!1,l=>typeof l=="boolean");return(s?(0,p.variantToString)(this._impl.variant)+":":"")+(0,de.getFEN)(this._impl,r,a,o)}else if(arguments.length===1&&typeof t=="string"){const i=(0,de.parseFEN)(this._impl.variant,t,!1);return this._impl=i.position,{fiftyMoveClock:i.fiftyMoveClock,fullMoveNumber:i.fullMoveNumber}}else if(arguments.length>=2&&typeof t=="string"&&typeof n=="boolean"){const i=(0,de.parseFEN)(this._impl.variant,t,n);return this._impl=i.position,{fiftyMoveClock:i.fiftyMoveClock,fullMoveNumber:i.fullMoveNumber}}else throw new b.IllegalArgument("Position.fen()")}variant(){return(0,p.variantToString)(this._impl.variant)}square(t,n){const i=(0,p.squareFromString)(t);if(i<0)throw new b.IllegalArgument("Position.square()");if(arguments.length===1){const r=this._impl.board[i];return r===-1?"-":(0,p.coloredPieceToString)(r)}else if(n==="-")this._impl.board[i]=-1,this._impl.legal=null,this._impl.effectiveCastling=null,this._impl.effectiveEnPassant=null;else{const r=(0,p.coloredPieceFromString)(n);if(r<0)throw new b.IllegalArgument("Position.square()");this._impl.board[i]=r,this._impl.legal=null,this._impl.effectiveCastling=null,this._impl.effectiveEnPassant=null}}turn(t){if(arguments.length===0)return(0,p.colorToString)(this._impl.turn);{const n=(0,p.colorFromString)(t);if(n<0)throw new b.IllegalArgument("Position.turn()");this._impl.turn=n,this._impl.legal=null,this._impl.effectiveEnPassant=null}}castling(t,n){if(!(this._impl.variant===1?(0,gt.isCastle960)(t):(0,gt.isCastle)(t)))throw new b.IllegalArgument("Position.castling()");const i=(0,p.colorFromString)(t[0]),r=this._impl.variant===1?(0,p.fileFromString)(t[1]):t[1]==="k"?7:0;if(arguments.length===1)return(this._impl.castling[i]&1<<r)!==0;if(typeof n=="boolean")n?this._impl.castling[i]|=1<<r:this._impl.castling[i]&=~(1<<r),this._impl.effectiveCastling=null;else throw new b.IllegalArgument("Position.castling()")}effectiveCastling(t){if(!(this._impl.variant===1?(0,gt.isCastle960)(t):(0,gt.isCastle)(t)))throw new b.IllegalArgument("Position.effectiveCastling()");const n=(0,p.colorFromString)(t[0]),i=this._impl.variant===1?(0,p.fileFromString)(t[1]):t[1]==="k"?7:0;return(0,Qe.refreshEffectiveCastling)(this._impl),(this._impl.effectiveCastling[n]&1<<i)!==0}enPassant(t){if(arguments.length===0)return this._impl.enPassant<0?"-":(0,p.fileToString)(this._impl.enPassant);if(t==="-")this._impl.enPassant=-1,this._impl.effectiveEnPassant=-1;else{const n=(0,p.fileFromString)(t);if(n<0)throw new b.IllegalArgument("Position.enPassant()");this._impl.enPassant=n,this._impl.effectiveEnPassant=null}}effectiveEnPassant(){return(0,Qe.refreshEffectiveEnPassant)(this._impl),this._impl.effectiveEnPassant<0?"-":(0,p.fileToString)(this._impl.effectiveEnPassant)}isAttacked(t,n){const i=(0,p.squareFromString)(t),r=(0,p.colorFromString)(n);if(i<0||r<0)throw new b.IllegalArgument("Position.isAttacked()");return(0,Dn.isAttacked)(this._impl,i,r)}getAttacks(t,n){const i=(0,p.squareFromString)(t),r=(0,p.colorFromString)(n);if(i<0||r<0)throw new b.IllegalArgument("Position.getAttacks()");return(0,Dn.getAttacks)(this._impl,i,r).map(p.squareToString)}isLegal(){return(0,Qe.isLegal)(this._impl)}kingSquare(t){const n=(0,p.colorFromString)(t);if(n<0)throw new b.IllegalArgument("Position.kingSquare()");(0,Qe.refreshLegalFlagAndKingSquares)(this._impl);const i=this._impl.king[n];return i<0?!1:(0,p.squareToString)(i)}isCheck(){return(0,Y.isCheck)(this._impl)}isCheckmate(){return(0,Y.isCheckmate)(this._impl)}isStalemate(){return(0,Y.isStalemate)(this._impl)}isDead(t=!1){return(0,Y.isDead)(this._impl,t)}hasMove(){return(0,Y.hasMove)(this._impl)}moves(){return(0,Y.moves)(this._impl)}isMoveLegal(t,n){const i=(0,p.squareFromString)(t),r=(0,p.squareFromString)(n);if(i<0||r<0)throw new b.IllegalArgument("Position.isMoveLegal()");const a=(0,Y.isMoveLegal)(this._impl,i,r);if(!a)return!1;switch(a.type){case"promotion":{const s=o=>{const l=(0,p.pieceFromString)(o);if(l>=0){const u=a.moveDescriptorFactory(l);if(u)return u}throw new b.IllegalArgument("Position.isMoveLegal()")};return s.status="promotion",s}case"regular":{const s=()=>a.moveDescriptor;return s.status="regular",s}}}play(t){if(typeof t=="string")try{return(0,Y.play)(this._impl,(0,be.parseNotation)(this._impl,t,!1,"standard")),!0}catch(n){if(n instanceof b.InvalidNotation)return!1;throw n}else{if(t instanceof We.MoveDescriptorImpl)return(0,Y.play)(this._impl,t),!0;throw new b.IllegalArgument("Position.play()")}}isNullMoveLegal(){return(0,Y.isNullMoveLegal)(this._impl)}playNullMove(){return(0,Y.playNullMove)(this._impl)}notation(t,n){if(arguments.length===1&&t instanceof We.MoveDescriptorImpl)return(0,be.getNotation)(this._impl,t,"standard");if(arguments.length===1&&typeof t=="string")return(0,be.parseNotation)(this._impl,t,!1,"standard");if(arguments.length>=2&&typeof t=="string"&&typeof n=="boolean")return(0,be.parseNotation)(this._impl,t,n,"standard");throw new b.IllegalArgument("Position.notation()")}figurineNotation(t,n){if(arguments.length===1&&t instanceof We.MoveDescriptorImpl)return(0,be.getNotation)(this._impl,t,"figurine");if(arguments.length===1&&typeof t=="string")return(0,be.parseNotation)(this._impl,t,!1,"figurine");if(arguments.length>=2&&typeof t=="string"&&typeof n=="boolean")return(0,be.parseNotation)(this._impl,t,n,"figurine");throw new b.IllegalArgument("Position.figurineNotation()")}uci(t,n){if(arguments.length===1&&t instanceof We.MoveDescriptorImpl)return(0,mt.getUCINotation)(this._impl,t,!1);if(arguments.length>=2&&t instanceof We.MoveDescriptorImpl&&typeof n=="boolean")return(0,mt.getUCINotation)(this._impl,t,n);if(arguments.length===1&&typeof t=="string")return(0,mt.parseUCINotation)(this._impl,t,!1);if(arguments.length>=2&&typeof t=="string"&&typeof n=="boolean")return(0,mt.parseUCINotation)(this._impl,t,n);throw new b.IllegalArgument("Position.uci()")}}ce.Position=je;function Gn(e){return Number.isInteger(e)&&e>=0&&e<960}function ua(e,t){return function(n,i,r){if(e[n]===void 0)return i;{const a=e[n];if(!r(a))throw new b.IllegalArgument(t);return a}}}var z={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(z,"__esModule",{value:!0}),z.Variation=z.Node=z.AbstractNode=void 0;class Gt{constructor(){}}z.AbstractNode=Gt;class fa extends Gt{constructor(){super()}isVariation(){return!1}toString(){return`${this.id()}[${this.notation()}]`}}z.Node=fa;class ca extends Gt{constructor(){super()}isVariation(){return!0}toString(){return this.id()}}z.Variation=ca;var Re={},Pt={},re={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */var da=ue&&ue.__classPrivateFieldSet||function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},Nt=ue&&ue.__classPrivateFieldGet||function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},It,He;Object.defineProperty(re,"__esModule",{value:!0}),re.POJOExceptionBuilder=void 0,re.decodeStringField=ga,re.decodeNumberField=ma,re.decodeBooleanField=Pa,re.decodeArrayField=Na,re.decodeObjectField=Ia;const ha=v,Je=K;class _a{constructor(t){It.set(this,void 0),He.set(this,[]),da(this,It,t,"f")}push(t){Nt(this,He,"f").push(t)}pop(){Nt(this,He,"f").pop()}build(t,...n){let i="",r=!0;for(const a of Nt(this,He,"f"))typeof a=="number"?i+=`[${a}]`:i+=r?a:"."+a,r=!1;return new ha.InvalidPOJO(Nt(this,It,"f"),i,t,...n)}}re.POJOExceptionBuilder=_a,It=new WeakMap,He=new WeakMap;function ga(e,t,n,i){if(!(t in e))return;n.push(t);const r=e[t];if(typeof r=="string")i(r);else if(r!==void 0)throw n.build(Je.i18n.INVALID_POJO_STRING_FIELD);n.pop()}function ma(e,t,n,i){if(!(t in e))return;n.push(t);const r=e[t];if(typeof r=="number")i(r);else if(r!==void 0)throw n.build(Je.i18n.INVALID_POJO_NUMBER_FIELD);n.pop()}function Pa(e,t,n,i){if(!(t in e))return;n.push(t);const r=e[t];if(typeof r=="boolean")i(r);else if(r!==void 0)throw n.build(Je.i18n.INVALID_POJO_BOOLEAN_FIELD);n.pop()}function Na(e,t,n,i){if(!(t in e))return;n.push(t);const r=e[t];if(Array.isArray(r))i(r);else if(r!==void 0)throw n.build(Je.i18n.INVALID_POJO_ARRAY_FIELD);n.pop()}function Ia(e,t,n,i){if(!(t in e))return;n.push(t);const r=e[t];if(typeof r=="object"&&r!==null)i(r);else if(r!==void 0)throw n.build(Je.i18n.INVALID_POJO_OBJECT_FIELD);n.pop()}/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.MoveTreeRoot=void 0;const G=v,qn=E,U=K,Kn=z,T=ce,pe=te,he=re,ba=I;class _e{constructor(){this._position=new T.Position,this._fullMoveNumber=1,this._mainVariationData=ve(this,!0)}clearTree(){this._mainVariationData=ve(this,!0)}mainVariation(){return new De(this._mainVariationData,this._position)}findById(t,n){const i=t.split("-");if(i.length%2!==1)return;const r=new T.Position(this._position);let a=this._mainVariationData;for(let o=0;o+1<i.length;o+=2){const l=Bn(a,i[o],r);if(l===void 0)return;const u=/^v(\d+)$/.exec(i[o+1]);if(!u)return;const f=parseInt(u[1]);if(f>=l.variations.length)return;a=l.variations[f]}const s=i[i.length-1];if(s==="start")return new De(a,r);if(n&&s==="end"){if(a.child===void 0)return new De(a,r);{let o=a.child;for(;o.child!==void 0;)Q(r,o),o=o.child;return new ae(o,r)}}else{const o=Bn(a,s,r);return o===void 0?void 0:new ae(o,r)}}getPojo(t){const n=this._position.variant();n!=="regular"&&(t.variant=n),(0,qn.variantWithCanonicalStartPosition)(n)&&T.Position.isEqual(this._position,new T.Position(n))&&this._fullMoveNumber===1||(t.initialPosition=this._position.fen({fullMoveNumber:this._fullMoveNumber}));const r=$n(new T.Position(this._position),this._mainVariationData,!0);(!Array.isArray(r)||r.length>0)&&(t.mainVariation=r)}setPojo(t,n){let i="regular",r=!1;if((0,he.decodeStringField)(t,"variant",n,a=>{if((0,ba.variantFromString)(a)<0)throw n.build(U.i18n.INVALID_VARIANT_IN_POJO);i=a}),(0,he.decodeStringField)(t,"initialPosition",n,a=>{this._position=new T.Position(i,"empty");try{const{fullMoveNumber:s}=this._position.fen(a);this._fullMoveNumber=s,r=!0}catch(s){throw s instanceof G.InvalidFEN?n.build(U.i18n.INVALID_FEN_IN_POJO,s.message):s}}),i!=="regular"&&!r){if(!(0,qn.variantWithCanonicalStartPosition)(i))throw n.push("initialPosition"),n.build(U.i18n.MISSING_INITIAL_POSITION_IN_POJO,i);this._position=new T.Position(i),this._fullMoveNumber=1}"mainVariation"in t&&t.mainVariation!==void 0?(n.push("mainVariation"),this._mainVariationData=Un(t.mainVariation,this,this._position,0,this._fullMoveNumber,!0,n),n.pop()):this.clearTree()}}Pt.MoveTreeRoot=_e;function Bn(e,t,n){let i=e.child;for(;i!==void 0;){if(t===i.fullMoveNumber+i.moveColor)return i;Q(n,i),i=i.child}}function $n(e,t,n){const i=[];let r=t.child;for(;r!==void 0;)i.push(pa(e,r)),Q(e,r),r=r.child;const a={nodes:i};let s=!0;return t.isLongVariation!==n&&(a.isLongVariation=t.isLongVariation,s=!1),xn(a,t)&&(s=!1),s?a.nodes:a}function pa(e,t){const n={notation:t.moveDescriptor===null?"--":e.notation(t.moveDescriptor)};let i=!0;return t.variations.length>0&&(n.variations=t.variations.map(r=>$n(new T.Position(e),r,!1)),i=!1),xn(n,t)&&(i=!1),i?n.notation:n}function xn(e,t){let n=!1;return t.comment!==void 0&&(e.comment=t.comment,t.isLongComment&&(e.isLongComment=!0),n=!0),t.nags.size>0&&(e.nags=Ut(t),n=!0),t.tags.size>0&&(e.tags=Ea(t),n=!0),n}function Un(e,t,n,i,r,a,s){let o,l;if(Array.isArray(e))o=ve(t,a),l=e;else if(typeof e=="object"&&e!==null){let f=a;if((0,he.decodeBooleanField)(e,"isLongVariation",s,d=>{f=d}),o=ve(t,f),Wn(e,o,s),s.push("nodes"),!("nodes"in e)||!Array.isArray(e.nodes))throw s.build(U.i18n.INVALID_OR_MISSING_NODE_ARRAY);l=e.nodes}else throw s.build(U.i18n.NOT_A_VARIATION_POJO);let u=o;n=new T.Position(n);for(let f=0;f<l.length;++f)s.push(f),u.child=va(l[f],o,n,i,r,s),s.pop(),u=u.child,Q(n,u),i=ye(u),n.turn()==="w"&&++r;return Array.isArray(e)||s.pop(),o}function va(e,t,n,i,r,a){let s;if(typeof e=="string")s=Qn(n,e,a);else if(typeof e=="object"&&e!==null){if(a.push("notation"),!("notation"in e)||typeof e.notation!="string")throw a.build(U.i18n.INVALID_OR_MISSING_NOTATION_FIELD);s=Qn(n,e.notation,a),a.pop()}else throw a.build(U.i18n.NOT_A_NODE_POJO);const o=qt(t,n.turn(),i,r,s);return typeof e=="object"&&e!==null&&(Wn(e,o,a),(0,he.decodeArrayField)(e,"variations",a,l=>{for(let u=0;u<l.length;++u)a.push(u),o.variations.push(Un(l[u],o,n,i,r,!1,a)),a.pop()})),o}function Qn(e,t,n){try{return Kt(e,t)}catch(i){throw i instanceof G.InvalidNotation?n.build(U.i18n.INVALID_MOVE_IN_POJO,t,i.message):i}}function Wn(e,t,n){(0,he.decodeStringField)(e,"comment",n,i=>{t.comment=i}),(0,he.decodeBooleanField)(e,"isLongComment",n,i=>{t.isLongComment=i}),(0,he.decodeArrayField)(e,"nags",n,i=>{for(let r=0;r<i.length;++r){const a=i[r];if(a!==void 0){if(!(0,pe.isValidNag)(a))throw n.push(r),n.build(U.i18n.INVALID_NAG_IN_POJO,a);t.nags.add(a)}}}),(0,he.decodeObjectField)(e,"tags",n,i=>{for(const r in i){if(!Qt(r))throw n.push(`[${r}]`),n.build(U.i18n.INVALID_TAG_IN_POJO,r);const a=i[r];if(a!==void 0){if(typeof a!="string")throw n.push(r),n.build(U.i18n.INVALID_TAG_IN_POJO,r);t.tags.set(r,a)}}})}function qt(e,t,n,i,r){return{parentVariation:e,child:void 0,variations:[],moveColor:t,fiftyMoveClock:n,fullMoveNumber:i,moveDescriptor:r,nags:new Set,tags:new Map,comment:void 0,isLongComment:!1}}function ve(e,t){return{parent:e,child:void 0,isLongVariation:t,nags:new Set,tags:new Map,comment:void 0,isLongComment:!1}}function Kt(e,t){if(t==="--"){if(!e.isNullMoveLegal())throw new G.InvalidNotation(e.fen(),"--",U.i18n.ILLEGAL_NULL_MOVE);return null}else return e.notation(t)}function Q(e,t){t.moveDescriptor===null?e.playNullMove():e.play(t.moveDescriptor)}function ye(e){return e.moveDescriptor===null?e.fiftyMoveClock:e.moveDescriptor.isCapture()||e.moveDescriptor.movingPiece()==="p"?0:e.fiftyMoveClock+1}function Bt(e){return e.moveColor==="w"?e.fullMoveNumber:e.fullMoveNumber+1}function $t(e){if(e.parent instanceof _e)return new T.Position(e.parent._position);{let t=e.parent.parentVariation.child;const n=$t(e.parent.parentVariation);for(;t!==e.parent;)Q(n,t),t=t.child;return n}}function jn(e){return Hn(e.parentVariation)+e.fullMoveNumber+e.moveColor}function Hn(e){if(e.parent instanceof _e)return"";{const t=jn(e.parent),n=e.parent.variations.indexOf(e);return`${t}-v${n}-`}}function xt(e){for(;;){if(!e.isLongVariation)return!1;if(e.parent instanceof _e)return!0;e=e.parent.parentVariation}}function bt(e,t){return Number.isInteger(e)&&e>=0&&e<t.variations.length}function Ut(e){const t=[];for(const n of e.nags)t.push(n);return t.sort((n,i)=>n-i)}function Jn(e,t){const n=new Set;for(const i of e.nags)t(i)&&n.add(i);e.nags=n}function Qt(e){return typeof e=="string"&&/^\w+$/.test(e)}function Xn(e){const t=[];for(const n of e.tags.keys())t.push(n);return t.sort()}function Yn(e,t){const n=new Map;for(const[i,r]of e.tags.entries())t(i,r)&&n.set(i,r);e.tags=n}function Ea(e){const t={};for(const[n,i]of e.tags.entries())t[n]=i;return t}class ae extends Kn.Node{constructor(t,n){super(),this._data=t,this._positionBefore=n}id(){return jn(this._data)}nags(){return Ut(this._data)}hasNag(t){if(!(0,pe.isValidNag)(t))throw new G.IllegalArgument("Node.hasNag()");return this._data.nags.has(t)}addNag(t){if(!(0,pe.isValidNag)(t))throw new G.IllegalArgument("Node.addNag()");return this._data.nags.add(t)}removeNag(t){if(!(0,pe.isValidNag)(t))throw new G.IllegalArgument("Node.removeNag()");return this._data.nags.delete(t)}clearNags(){this._data.nags.clear()}filterNags(t){Jn(this._data,t)}tags(){return Xn(this._data)}tag(t,n){if(!Qt(t))throw new G.IllegalArgument("Node.tag()");if(arguments.length===1)return this._data.tags.get(t);n==null?this._data.tags.delete(t):this._data.tags.set(t,String(n))}clearTags(){this._data.tags.clear()}filterTags(t){Yn(this._data,t)}comment(t,n){if(arguments.length===0)return this._data.comment;t==null?(this._data.comment=void 0,this._data.isLongComment=!1):(this._data.comment=String(t),this._data.isLongComment=!!n)}isLongComment(){return this._data.isLongComment&&xt(this._data.parentVariation)}parentVariation(){const t=$t(this._data.parentVariation);return new De(this._data.parentVariation,t)}previous(){let t=this._data.parentVariation.child;if(t===this._data)return;const n=$t(this._data.parentVariation);for(;t.child!==this._data;)Q(n,t),t=t.child;return new ae(t,n)}next(){if(this._data.child===void 0)return;const t=new T.Position(this._positionBefore);return Q(t,this._data),new ae(this._data.child,t)}notation(){return this._data.moveDescriptor===null?"--":this._positionBefore.notation(this._data.moveDescriptor)}figurineNotation(){return this._data.moveDescriptor===null?"--":this._positionBefore.figurineNotation(this._data.moveDescriptor)}positionBefore(){return new T.Position(this._positionBefore)}position(){const t=new T.Position(this._positionBefore);return Q(t,this._data),t}fen(){return this.position().fen({fiftyMoveClock:ye(this._data),fullMoveNumber:Bt(this._data)})}fiftyMoveClock(){return ye(this._data)}fullMoveNumber(){return this._data.fullMoveNumber}moveColor(){return this._data.moveColor}variations(){return this._data.variations.map(t=>new De(t,this._positionBefore))}play(t){const n=new T.Position(this._positionBefore);Q(n,this._data);const i=n.turn(),r=ye(this._data),a=Bt(this._data);return this._data.child=qt(this._data.parentVariation,i,r,a,Kt(n,t)),new ae(this._data.child,n)}removePrecedingMoves(){const t=wa(this._data);t._position=this._positionBefore,t._fullMoveNumber=this._data.fullMoveNumber,t._mainVariationData=ve(t,!0),t._mainVariationData.child=this._data,Wt(this._data,t._mainVariationData),zn(this._data,0)}removeFollowingMoves(){this._data.child=void 0}addVariation(t){const n=ve(this._data,t??!1);return this._data.variations.push(n),new De(n,this._positionBefore)}removeVariation(t){if(!bt(t,this._data))throw new G.IllegalArgument("Node.removeVariation()");this._data.variations=this._data.variations.slice(0,t).concat(this._data.variations.slice(t+1))}swapVariations(t,n){if(!bt(t,this._data)||!bt(n,this._data))throw new G.IllegalArgument("Node.swapVariations()");const i=this._data.variations[t];this._data.variations[t]=this._data.variations[n],this._data.variations[n]=i}promoteVariation(t){if(!bt(t,this._data)||this._data.variations[t].child===void 0)throw new G.IllegalArgument("Node.promoteVariation()");const n=this._data,i=this._data.variations[t].child,r=n.variations;n.variations=[],r[t]=ve(i,!1),r[t].child=n,this._data=i,i.variations=r.concat(i.variations),Aa(n).child=i,Wt(i,n.parentVariation),Wt(n,r[t]);for(const a of i.variations)a.parent=i}}function wa(e){let t=e;for(;!(t instanceof _e);)t=t.parentVariation.parent;return t}function Aa(e){let t=e.parentVariation;for(;t.child!==e;)t=t.child;return t}function Wt(e,t){let n=e;for(;n!==void 0;)n.parentVariation=t,n=n.child}function zn(e,t){let n=e;for(;n!==void 0;){n.fiftyMoveClock=t;for(const i of n.variations)zn(i.child,t);t=ye(n),n=n.child}}class De extends Kn.Variation{constructor(t,n){super(),this._data=t,this._initialPosition=n}id(){return Hn(this._data)+"start"}nags(){return Ut(this._data)}hasNag(t){if(!(0,pe.isValidNag)(t))throw new G.IllegalArgument("Variation.hasNag()");return this._data.nags.has(t)}addNag(t){if(!(0,pe.isValidNag)(t))throw new G.IllegalArgument("Variation.addNag()");return this._data.nags.add(t)}removeNag(t){if(!(0,pe.isValidNag)(t))throw new G.IllegalArgument("Variation.removeNag()");return this._data.nags.delete(t)}clearNags(){this._data.nags.clear()}filterNags(t){Jn(this._data,t)}tags(){return Xn(this._data)}tag(t,n){if(!Qt(t))throw new G.IllegalArgument("Variation.tag()");if(arguments.length===1)return this._data.tags.get(t);n==null?this._data.tags.delete(t):this._data.tags.set(t,String(n))}clearTags(){this._data.tags.clear()}filterTags(t){Yn(this._data,t)}comment(t,n){if(arguments.length===0)return this._data.comment;t==null?(this._data.comment=void 0,this._data.isLongComment=!1):(this._data.comment=String(t),this._data.isLongComment=!!n)}isLongComment(){return this._data.isLongComment&&xt(this._data)}parentNode(){return this._data.parent instanceof _e?void 0:new ae(this._data.parent,this._initialPosition)}first(){return this._data.child===void 0?void 0:new ae(this._data.child,this._initialPosition)}nodes(){const t=[];let n=this._data.child,i,r=this._initialPosition;for(;n!==void 0;)r=new T.Position(r),i!==void 0&&Q(r,i),t.push(new ae(n,r)),i=n,n=n.child;return t}plyCount(){let t=0,n=this._data.child;for(;n!==void 0;)++t,n=n.child;return t}isLongVariation(){return xt(this._data)}initialPosition(){return new T.Position(this._initialPosition)}initialFEN(){return this._initialPosition.fen({fiftyMoveClock:this.initialFiftyMoveClock(),fullMoveNumber:this.initialFullMoveNumber()})}initialFiftyMoveClock(){return this._data.parent instanceof _e?0:this._data.parent.fiftyMoveClock}initialFullMoveNumber(){return this._data.parent instanceof _e?this._data.parent._fullMoveNumber:this._data.parent.fullMoveNumber}finalPosition(){const t=new T.Position(this._initialPosition);for(let n=this._data.child;n!==void 0;n=n.child)Q(t,n);return t}finalFEN(){if(this._data.child===void 0)return this.initialFEN();const t=new T.Position(this._initialPosition);let n=this._data.child;for(;Q(t,n),n.child!==void 0;)n=n.child;return t.fen({fiftyMoveClock:ye(n),fullMoveNumber:Bt(n)})}play(t){const n=this._initialPosition.turn(),i=this.initialFiftyMoveClock(),r=this.initialFullMoveNumber();return this._data.child=qt(this._data,n,i,r,Kt(this._initialPosition,t)),new ae(this._data.child,this._initialPosition)}clearMoves(){this._data.child=void 0}}/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(Re,"__esModule",{value:!0}),Re.Game=void 0;const Ee=Ce,W=v,pt=E,Ge=K,Xe=ce,qe=te,ka=Pt,C=re,we=I;class jt{constructor(){this._playerName=[void 0,void 0],this._playerElo=[void 0,void 0],this._playerTitle=[void 0,void 0],this._round=[void 0,void 0,void 0],this._result=3,this._moveTreeRoot=new ka.MoveTreeRoot}clearHeaders(){this._playerName=[void 0,void 0],this._playerElo=[void 0,void 0],this._playerTitle=[void 0,void 0],this._event=void 0,this._round=[void 0,void 0,void 0],this._date=void 0,this._site=void 0,this._annotator=void 0,this._eco=void 0,this._opening=void 0,this._openingVariation=void 0,this._openingSubVariation=void 0,this._termination=void 0,this._result=3}playerName(t,n){const i=(0,we.colorFromString)(t);if(i<0)throw new W.IllegalArgument("Game.playerName()");if(arguments.length===1)return this._playerName[i];this._playerName[i]=se(n)}playerElo(t,n){const i=(0,we.colorFromString)(t);if(i<0)throw new W.IllegalArgument("Game.playerElo()");if(arguments.length===1)return this._playerElo[i];if(n=Zn(n),n===void 0||(0,qe.isValidElo)(n))this._playerElo[i]=n;else throw new W.IllegalArgument("Game.playerElo()")}playerTitle(t,n){const i=(0,we.colorFromString)(t);if(i<0)throw new W.IllegalArgument("Game.playerTitle()");if(arguments.length===1)return this._playerTitle[i];this._playerTitle[i]=se(n)}event(t){if(arguments.length===0)return this._event;this._event=se(t)}round(t){if(arguments.length===0)return this._round[0];this._setRoundPart(0,t,"Game.round()")}subRound(t){if(arguments.length===0)return this._round[1];this._setRoundPart(1,t,"Game.subRound()")}subSubRound(t){if(arguments.length===0)return this._round[2];this._setRoundPart(2,t,"Game.subSubRound()")}_setRoundPart(t,n,i){if(n=Zn(n),n===void 0||(0,qe.isValidRound)(n))this._round[t]=n;else throw new W.IllegalArgument(i)}fullRound(){return ei(this._round[0],this._round[1],this._round[2],"?")}date(t,n,i){switch(arguments.length){case 0:return this._date;case 1:if(t==null)this._date=void 0;else if(t instanceof Ee.DateValue)this._date=t;else if(t instanceof Date)this._date=new Ee.DateValue(t);else if(Ee.DateValue.isValid(t))this._date=new Ee.DateValue(t);else throw new W.IllegalArgument("Game.date()");break;default:if(Ee.DateValue.isValid(t,n,i))this._date=new Ee.DateValue(t,n,i);else throw new W.IllegalArgument("Game.date()");break}}dateAsDate(){return this._date===void 0?void 0:this._date.toDate()}dateAsString(t){return this._date===void 0?void 0:this._date.toHumanReadableString(t)}site(t){if(arguments.length===0)return this._site;this._site=se(t)}annotator(t){if(arguments.length===0)return this._annotator;this._annotator=se(t)}eco(t){if(arguments.length===0)return this._eco;if(t=se(t),t!==void 0&&!(0,pt.isValidECO)(t))throw new W.IllegalArgument("Game.eco()");this._eco=t}opening(t){if(arguments.length===0)return this._opening;this._opening=se(t)}openingVariation(t){if(arguments.length===0)return this._openingVariation;this._openingVariation=se(t)}openingSubVariation(t){if(arguments.length===0)return this._openingSubVariation;this._openingSubVariation=se(t)}termination(t){if(arguments.length===0)return this._termination;this._termination=se(t)}result(t){if(arguments.length===0)return(0,we.resultToString)(this._result);{const n=(0,we.resultFromString)(t);if(n<0)throw new W.IllegalArgument("Game.result()");this._result=n}}variant(){return this._moveTreeRoot._position.variant()}initialPosition(t,n){if(arguments.length===0)return new Xe.Position(this._moveTreeRoot._position);if(!(t instanceof Xe.Position))throw new W.IllegalArgument("Game.initialPosition()");if(arguments.length>=2){if(!Number.isInteger(n))throw new W.IllegalArgument("Game.initialPosition()");this._moveTreeRoot._fullMoveNumber=n}else this._moveTreeRoot._fullMoveNumber=1;this._moveTreeRoot._position=new Xe.Position(t),this._moveTreeRoot.clearTree()}initialFEN(){return this._moveTreeRoot._position.fen({fiftyMoveClock:0,fullMoveNumber:this._moveTreeRoot._fullMoveNumber})}initialFullMoveNumber(){return this._moveTreeRoot._fullMoveNumber}finalPosition(){return this._moveTreeRoot.mainVariation().finalPosition()}finalFEN(){return this._moveTreeRoot.mainVariation().finalFEN()}mainVariation(){return this._moveTreeRoot.mainVariation()}nodes(t=!1){if(!t)return this.mainVariation().nodes();const n=[];function i(r){for(const a of r.nodes()){for(const s of a.variations())i(s);n.push(a)}}return i(this.mainVariation()),n}plyCount(){return this._moveTreeRoot.mainVariation().plyCount()}findById(t,n=!0){return this._moveTreeRoot.findById(t,n)}pojo(){const t={};function n(r,a){return r._playerName[a]===void 0&&r._playerElo[a]===void 0&&r._playerTitle[a]===void 0}function i(r,a){const s={};return r._playerName[a]!==void 0&&(s.name=r._playerName[a]),r._playerElo[a]!==void 0&&(s.elo=r._playerElo[a]),r._playerTitle[a]!==void 0&&(s.title=r._playerTitle[a]),s}return n(this,0)||(t.white=i(this,0)),n(this,1)||(t.black=i(this,1)),this._event!==void 0&&(t.event=this._event),this._round[0]!==void 0&&(t.round=this._round[0]),this._round[1]!==void 0&&(t.subRound=this._round[1]),this._round[2]!==void 0&&(t.subSubRound=this._round[2]),this._date!==void 0&&(t.date=this._date.toString()),this._site!==void 0&&(t.site=this._site),this._annotator!==void 0&&(t.annotator=this._annotator),this._eco!==void 0&&(t.eco=this._eco),this._opening!==void 0&&(t.opening=this._opening),this._openingVariation!==void 0&&(t.openingVariation=this._openingVariation),this._openingSubVariation!==void 0&&(t.openingSubVariation=this._openingSubVariation),this._termination!==void 0&&(t.termination=this._termination),this._result!==3&&(t.result=this.result()),this._moveTreeRoot.getPojo(t),t}static fromPOJO(t){if(typeof t!="object"||t===null)throw new W.InvalidPOJO(t,"",Ge.i18n.POJO_MUST_BE_AN_OBJECT);const n=new jt,i=new C.POJOExceptionBuilder(t);function r(s,o){(0,C.decodeStringField)(s,"name",i,l=>{n._playerName[o]=l}),(0,C.decodeNumberField)(s,"elo",i,l=>{if(!(0,qe.isValidElo)(l))throw i.build(Ge.i18n.INVALID_ELO_IN_POJO);n._playerElo[o]=l}),(0,C.decodeStringField)(s,"title",i,l=>{n._playerTitle[o]=l})}function a(s,o){if(!(0,qe.isValidRound)(s))throw i.build(Ge.i18n.INVALID_ROUND_IN_POJO);n._round[o]=s}return(0,C.decodeObjectField)(t,"white",i,s=>{r(s,0)}),(0,C.decodeObjectField)(t,"black",i,s=>{r(s,1)}),(0,C.decodeStringField)(t,"event",i,s=>{n._event=s}),(0,C.decodeNumberField)(t,"round",i,s=>{a(s,0)}),(0,C.decodeNumberField)(t,"subRound",i,s=>{a(s,1)}),(0,C.decodeNumberField)(t,"subSubRound",i,s=>{a(s,2)}),(0,C.decodeStringField)(t,"date",i,s=>{const o=Ee.DateValue.fromString(s);if(o===void 0)throw i.build(Ge.i18n.INVALID_DATE_IN_POJO);n._date=o}),(0,C.decodeStringField)(t,"site",i,s=>{n._site=s}),(0,C.decodeStringField)(t,"annotator",i,s=>{n._annotator=s}),(0,C.decodeStringField)(t,"eco",i,s=>{if(!(0,pt.isValidECO)(s))throw i.build(Ge.i18n.INVALID_ECO_CODE_IN_POJO);n._eco=s}),(0,C.decodeStringField)(t,"opening",i,s=>{n._opening=s}),(0,C.decodeStringField)(t,"openingVariation",i,s=>{n._openingVariation=s}),(0,C.decodeStringField)(t,"openingSubVariation",i,s=>{n._openingSubVariation=s}),(0,C.decodeStringField)(t,"termination",i,s=>{n._termination=s}),(0,C.decodeStringField)(t,"result",i,s=>{const o=(0,we.resultFromString)(s);if(o<0)throw i.build(Ge.i18n.INVALID_RESULT_IN_POJO);n._result=o}),n._moveTreeRoot.setPojo(t,i),n}ascii(){const t=[];function n(o){o!==void 0&&t.push(o)}n(Sa(this._event,this._round[0],this._round[1],this._round[2])),n(Ye("Site",this._site)),n(Ye("Date",this.dateAsString("en-us"))),n(ti("White",this._playerName[0],this._playerElo[0],this._playerTitle[0])),n(ti("Black",this._playerName[1],this._playerElo[1],this._playerTitle[1])),n(Ye("Annotator",this._annotator)),n(Ye("ECO",this._eco)),n(Ca(this._opening,this._openingVariation,this._openingSubVariation)),n(Ye("Termination",this._termination));const i=this._moveTreeRoot._position.variant();i!=="regular"&&t.push("Variant: "+i),(!(0,pt.variantWithCanonicalStartPosition)(i)||!Xe.Position.isEqual(this._moveTreeRoot._position,new Xe.Position(i)))&&t.push(this._moveTreeRoot._position.ascii());function r(o){return o.first()!==void 0||o.nags().length>0||o.tags().length>0||o.comment()!==void 0}function a(o,l,u){const f=l+o.fullMoveNumber()+(o.moveColor()==="w"?".":"...")+o.notation(),d=ni(o);t.push(d.length===0?f:f+" "+d.join(" "));let c=!1;for(const h of o.variations())r(h)&&(t.push(l+" |"),s(h,l+(u?" |  ":"    "),l+" +- "),c=!0);return c}function s(o,l,u,f){const d=ni(o);d.length>0&&t.push(u+d.join(" "));let c=o.first(),h=!1,_=!0;for(;c!==void 0;){h&&t.push(l+" |");const w=c.next();h=a(c,_&&d.length===0?u:l,w!==void 0),_=!1,c=w}}return s(this._moveTreeRoot.mainVariation(),"",""),t.push((0,we.resultToString)(this._result)),t.join(`
`)}}Re.Game=jt;function se(e){return e==null?void 0:String(e)}function Zn(e){return e==null?void 0:Number(e)}function oe(e){return e=(0,qe.trimAndCollapseSpaces)(e),e===""?"<empty>":e}function Ye(e,t){return t===void 0?void 0:`${e}: ${oe(t)}`}function Sa(e,t,n,i){if(e===void 0&&t===void 0&&n===void 0&&i===void 0)return;let r=e===void 0?"Event: <undefined>":`Event: ${oe(e)}`;const a=ei(t,n,i,"*");return a!==void 0&&(r+=` (${a})`),r}function ei(e,t,n,i){if(e===void 0&&t===void 0&&n===void 0)return;let r=e===void 0?i:String(e);return(t!==void 0||n!==void 0)&&(r+="."+(t??i)),n!==void 0&&(r+="."+n),r}function ti(e,t,n,i){if(t===void 0&&n===void 0&&i===void 0)return;let r=t===void 0?`${e}: <undefined>`:`${e}: ${oe(t)}`;return n!==void 0&&i!==void 0?r+=` (${oe(i)} ${n})`:n!==void 0?r+=` (${n})`:i!==void 0&&(r+=` (${oe(i)})`),r}function Ca(e,t,n){if(e===void 0&&t===void 0&&n===void 0)return;let i=e===void 0?"Opening: <undefined>":`Opening: ${oe(e)}`;return n!==void 0?i+=` (${t===void 0?"<undefined>":oe(t)}, ${oe(n)})`:t!==void 0&&(i+=` (${oe(t)})`),i}function ni(e){const t=[];for(const i of e.nags())t.push((0,pt.nagSymbol)(i));for(const i of e.tags())t.push(`${i}={${(0,qe.trimAndCollapseSpaces)(e.tag(i))}}`);const n=e.comment();return n!==void 0&&t.push(oe(n)),t}var Ae={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Database=void 0,Ae.isValidGameIndex=ri;const ii=v;function ri(e){return Number.isInteger(e)&&e>=0}class Oa{constructor(){}gameCount(){return this.doGameCount()}game(t){if(!ri(t))throw new ii.IllegalArgument("Database.game()");return this.doGame(t)}games(){const t=this.doGameCount(),n=i=>this.doGame(i);return{[Symbol.iterator](){return new Ta(t,n)}}}}Ae.Database=Oa;class Ta{constructor(t,n){this.gameIndex=0,this.gameCount=t,this.gameLoader=n}next(){for(;this.gameIndex<this.gameCount;)try{return{done:!1,value:this.gameLoader(this.gameIndex++)}}catch(t){if(!(t instanceof ii.InvalidPGN))throw t}return{done:!0,value:void 0}}}var vt={},Et={},wt={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(wt,"__esModule",{value:!0}),wt.TokenStream=void 0;const Ht=v,Jt=K,Xt=te;function M(e,t){const n=e;return n.needIncrementLineIndex=t!==void 0&&t,n.matchedIndex=-1,n.matched=null,n}const Ma=5,Fa=11,S=new Map;S.set("!!",3),S.set("!",1),S.set("!?",5),S.set("?!",6),S.set("?",2),S.set("??",4),S.set("+-",18),S.set("+/-",16),S.set("+/=",14),S.set("+=",14),S.set("=",10),S.set("~",13),S.set("inf",13),S.set("=/+",15),S.set("=+",15),S.set("-/+",17),S.set("-+",19),S.set("RR",145),S.set("N",146);class Va{constructor(t,n){this._pos=0,this._lineIndex=1,this._token=0,this._tokenValue=null,this._tokenCharacterIndex=-1,this._tokenLineIndex=-1,this._emptyLineBeforeToken=!1,this._emptyLineAfterToken=!1,this._matchSpaces=M(/[ \f\t\v]+/g),this._matchLineBreak=M(/\r?\n|\r/g,!0),this._matchFastAdvance=M(/[^ \f\t\v\r\n"{][^ \f\t\v\r\n"{10*]*/g),this._matchBeginHeader=M(/\[/g),this._matchEndHeader=M(/\]/g),this._matchHeaderId=M(/(\w+)/g),this._matchEnterHeaderValue=M(/"/g),this._matchMoveNumber=M(/[0-9]+\.(?:\.\.)?/g),this._matchMove=M(/(?:O-O(?:-O)?|0-0(?:-0)?|[KQRBN][a-h]?[1-8]?x?[a-h][1-8]|(?:[a-h]x?)?[a-h][1-8](?:=?[KQRBNP])?)[+#]?|--/g),this._matchNag=M(/([!?][!?]?|\+\/?[-=]|[-=]\/?\+|=|inf|~|RR|N)|\$([1-9][0-9]*)/g),this._matchEnterComment=M(/\{/g),this._matchBeginVariation=M(/\(/g),this._matchEndVariation=M(/\)/g),this._matchEndOfGame=M(/1-0|0-1|1\/2-1\/2|\*/g),this._headerValueMode=M(/((?:[^\\"\f\t\v\r\n]|\\[^\f\t\v\r\n])*)"/g),this._headerValueDegradedMode=M(/[^\r\n]*/g),this._commentMode=M(/((?:[^\\}]|\\(?:.|[\r\n]))*)\}/g,!0),t.codePointAt(0)===65279&&(t=t.substring(1)),this._text=t,n!==void 0&&(this._pos=n.pos,this._lineIndex=n.lineIndex)}text(){return this._text}currentLocation(){return{pos:this._pos,lineIndex:this._lineIndex}}emptyLineBeforeToken(){return this._emptyLineBeforeToken}emptyLineAfterToken(){return this._emptyLineAfterToken}token(){return this._token}tokenValue(){return this._tokenValue}tokenCharacterIndex(){return this._tokenCharacterIndex}tokenLineIndex(){return this._tokenLineIndex}isMoveTextSection(){return this._token>=Ma&&this._token<=Fa}consumeToken(){if(this._emptyLineBeforeToken=this._token===0||this._token===11?this.skipBlanks():this._emptyLineAfterToken,this._pos>=this._text.length)return this._tokenCharacterIndex=this._text.length,this._tokenLineIndex=this._lineIndex,!1;if(this._tokenCharacterIndex=this._pos,this._tokenLineIndex=this._lineIndex,this.testAtPos(this._matchMoveNumber))this._token=5,this._tokenValue=null;else if(this.testAtPos(this._matchMove))this._token=6,this._tokenValue=this._matchMove.matched[0];else if(this.testAtPos(this._matchNag))this._token=7,this._tokenValue=this._matchNag.matched[2]===void 0?S.get(this._matchNag.matched[1]):parseInt(this._matchNag.matched[2],10);else if(this.testAtPos(this._matchEnterComment)){if(!this.testAtPos(this._commentMode))throw new Ht.InvalidPGN(this._text,this._pos,this._lineIndex,Jt.i18n.INVALID_PGN_TOKEN);this._token=8,this._tokenValue=Ra(this._commentMode.matched[1])}else if(this.testAtPos(this._matchBeginVariation))this._token=9,this._tokenValue=null;else if(this.testAtPos(this._matchEndVariation))this._token=10,this._tokenValue=null;else if(this.testAtPos(this._matchEndOfGame))this._token=11,this._tokenValue=this._matchEndOfGame.matched[0];else if(this.testAtPos(this._matchBeginHeader))this._token=1,this._tokenValue=null;else if(this.testAtPos(this._matchEndHeader))this._token=2,this._tokenValue=null;else if(this.testAtPos(this._matchHeaderId))this._token=3,this._tokenValue=this._matchHeaderId.matched[1];else if(this.testAtPos(this._matchEnterHeaderValue)){if(!this.testAtPos(this._headerValueMode))throw new Ht.InvalidPGN(this._text,this._pos,this._lineIndex,Jt.i18n.INVALID_PGN_TOKEN);this._token=4,this._tokenValue=La(this._headerValueMode.matched[1])}else throw new Ht.InvalidPGN(this._text,this._pos,this._lineIndex,Jt.i18n.INVALID_PGN_TOKEN);return this._emptyLineAfterToken=this._token===11?!1:this.skipBlanks(),!0}skipGame(){let t=!1;for(this._token=0;;){if(this.skipBlanks(),this._pos>=this._text.length)return t;if(t=!0,this.testAtPos(this._matchEnterComment)){if(!this.testAtPos(this._commentMode))return this._pos=this._text.length,!0}else if(this.testAtPos(this._matchEnterHeaderValue))this.testAtPos(this._headerValueMode)||this.testAtPos(this._headerValueDegradedMode);else{if(this.testAtPos(this._matchEndOfGame))return!0;this.testAtPos(this._matchFastAdvance)}}}skipBlanks(){let t=0;for(;this._pos<this._text.length;)if(!this.testAtPos(this._matchSpaces))if(this.testAtPos(this._matchLineBreak))++t;else break;return t>=2}testAtPos(t){if(t.matchedIndex<this._pos&&(t.lastIndex=this._pos,t.matched=t.exec(this._text),t.matchedIndex=t.matched===null?this._text.length:t.matched.index),t.matchedIndex===this._pos){if(this._pos=t.lastIndex,t.needIncrementLineIndex){const n=/\r?\n|\r/g;for(;n.exec(t.matched[0]);)++this._lineIndex}return!0}else return!1}}wt.TokenStream=Va;function La(e){return(0,Xt.trimAndCollapseSpaces)(e.replace(/\\([\\"])/g,"$1"))}function Ra(e){e=e.replace(/\\([\\}])/g,"$1");const t=new Map;let n=e.replace(/\[%(\w+)\s([^[\]]*)\]/g,(i,r,a)=>(a=(0,Xt.trimAndCollapseSpaces)(a),a!==""&&t.set(r,a)," "));return n=(0,Xt.trimAndCollapseSpaces)(n),n===""&&(n=void 0),{comment:n,tags:t}}/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(Et,"__esModule",{value:!0}),Et.readDatabase=Qa,Et.readOneGame=Wa;const ya=Ae,Da=Ce,F=v,Ga=Re,ai=E,D=K,si=z,Yt=ce,zt=wt;function At(e){return e==="?"?void 0:e}function oi(e){if(/^\d+$/.test(e)){const t=Number(e);if(Number.isInteger(t))return t}}function qa(e){if(/^(\?|\d+)(?:\.(\?|\d+)(?:\.(\?|\d+)(?:\.(?:\?|\d+))*)?)?$/.test(e)){const t=Number(RegExp.$1),n=RegExp.$2?Number(RegExp.$2):void 0,i=RegExp.$3?Number(RegExp.$3):void 0;return{round:Number.isInteger(t)?t:void 0,subRound:Number.isInteger(n)?n:void 0,subSubRound:Number.isInteger(i)?i:void 0}}return{round:void 0,subRound:void 0,subSubRound:void 0}}function Ka(e){return(0,ai.isValidECO)(e)?e:void 0}function Ba(e){return e=e.toLowerCase(),e==="regular"||e==="standard"?"regular":e==="fischerandom"||/^chess[ -]?960$/.test(e)?"chess960":/^no[ -]king$/.test(e)?"no-king":/^white[ -]king[ -]only$/.test(e)?"white-king-only":/^black[ -]king[ -]only$/.test(e)?"black-king-only":/^anti[ -]?chess/.test(e)?"antichess":e==="horde"?"horde":void 0}function $a(e,t,n,i,r,a,s){switch(r=r.trim(),i){case"White":t.playerName("w",At(r));break;case"Black":t.playerName("b",At(r));break;case"WhiteElo":t.playerElo("w",oi(r));break;case"BlackElo":t.playerElo("b",oi(r));break;case"WhiteTitle":t.playerTitle("w",r);break;case"BlackTitle":t.playerTitle("b",r);break;case"Event":t.event(At(r));break;case"Round":{const{round:o,subRound:l,subSubRound:u}=qa(r);t.round(o),t.subRound(l),t.subSubRound(u);break}case"Date":t.date(Da.DateValue.fromPGNString(r));break;case"Site":t.site(At(r));break;case"Annotator":t.annotator(r);break;case"ECO":t.eco(Ka(r));break;case"Opening":t.opening(r);break;case"Variation":t.openingVariation(r);break;case"SubVariation":t.openingSubVariation(r);break;case"Termination":t.termination(r);break;case"FEN":n.fen=r,n.fenTokenCharacterIndex=a,n.fenTokenLineIndex=s;break;case"Variant":if(n.variant=Ba(r),n.variant===void 0)throw new F.InvalidPGN(e.text(),a,s,D.i18n.UNKNOWN_VARIANT,r);n.variantTokenCharacterIndex=a,n.variantTokenLineIndex=s;break}}function xa(e,t,n){if(n.fen!==void 0)try{const i=n.variant===void 0?new Yt.Position:new Yt.Position(n.variant,"empty"),r=i.fen(n.fen);t.initialPosition(i,r.fullMoveNumber)}catch(i){throw i instanceof F.InvalidFEN?new F.InvalidPGN(e.text(),n.fenTokenCharacterIndex,n.fenTokenLineIndex,D.i18n.INVALID_FEN_IN_PGN_TEXT,i.message):i}else if(n.variant!==void 0)if((0,ai.variantWithCanonicalStartPosition)(n.variant)){const i=new Yt.Position(n.variant,"start");t.initialPosition(i,1)}else throw new F.InvalidPGN(e.text(),n.variantTokenCharacterIndex,n.variantTokenLineIndex,D.i18n.VARIANT_WITHOUT_FEN,n.variant)}function li(e){const t=new Ga.Game;let n=!1,i=!1,r=null;const a=[],s={};for(;!n&&e.consumeToken();)switch(i=!0,e.isMoveTextSection()&&r===null&&(xa(e,t,s),r=t.mainVariation()),e.token()){case 1:{if(r!==null)throw new F.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),D.i18n.UNEXPECTED_PGN_HEADER);if(!e.consumeToken()||e.token()!==3)throw new F.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),D.i18n.MISSING_PGN_HEADER_ID);const o=e.tokenValue();if(!e.consumeToken()||e.token()!==4)throw new F.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),D.i18n.MISSING_PGN_HEADER_VALUE);const l=e.tokenValue(),u=e.tokenCharacterIndex(),f=e.tokenLineIndex();if(!e.consumeToken()||e.token()!==2)throw new F.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),D.i18n.MISSING_END_OF_PGN_HEADER);$a(e,t,s,o,l,u,f);break}case 5:break;case 6:try{r=r.play(e.tokenValue())}catch(o){throw o instanceof F.InvalidNotation?new F.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),D.i18n.INVALID_MOVE_IN_PGN_TEXT,o.notation,o.message):o}break;case 7:r.addNag(e.tokenValue());break;case 8:{const{comment:o,tags:l}=e.tokenValue();for(const[u,f]of l)r.tag(u,f);if(o!==void 0)if(r.comment()===void 0){const u=r instanceof si.Variation?e.emptyLineAfterToken():e.emptyLineBeforeToken();r.comment(o,u)}else{const u=r.isLongComment();r.comment(r.comment()+" "+o,u)}break}case 9:if(r instanceof si.Variation)throw new F.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),D.i18n.UNEXPECTED_BEGIN_OF_VARIATION);a.push(r),r=r.addVariation(e.emptyLineBeforeToken());break;case 10:if(a.length===0)throw new F.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),D.i18n.UNEXPECTED_END_OF_VARIATION);r=a.pop();break;case 11:n=!0,t.result(e.tokenValue());break;default:throw new F.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),D.i18n.INVALID_PGN_TOKEN)}if(a.length!==0)throw new F.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),D.i18n.UNEXPECTED_END_OF_GAME);return{game:t,atLeastOneTokenFound:i}}class Ua extends ya.Database{constructor(t){for(super(),this._currentGameIndex=-1,this._text=t,this._gameLocations=[],this._stream=new zt.TokenStream(t);;){const n=this._stream.currentLocation();if(!this._stream.skipGame())break;this._gameLocations.push(n)}}doGameCount(){return this._gameLocations.length}doGame(t){if(t>=this._gameLocations.length)throw new F.InvalidPGN(this._text,-1,-1,D.i18n.INVALID_GAME_INDEX,t,this._gameLocations.length);this._currentGameIndex!==t&&(this._stream=new zt.TokenStream(this._text,this._gameLocations[t])),this._currentGameIndex=-1;const{game:n}=li(this._stream);return this._currentGameIndex=t+1,n}}function Qa(e){return new Ua(e)}function Wa(e,t){const n=new zt.TokenStream(e);let i=0;for(;i!==t;){if(!n.skipGame())throw new F.InvalidPGN(e,-1,-1,D.i18n.INVALID_GAME_INDEX,t,i);++i}const{game:r,atLeastOneTokenFound:a}=li(n);if(!a)throw new F.InvalidPGN(e,-1,-1,D.i18n.INVALID_GAME_INDEX,t,i);return r}var kt={};/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(kt,"__esModule",{value:!0}),kt.writeGame=gi,kt.writeGames=Za;const ja=E,Ha=z,ui=ce,St=te;function fi(e){return e.replace(/([\\"])/g,"\\$1")}function ci(e){return e.replace(/([\\}])/g,"\\$1")}function Ct(e){return e!==void 0&&(e=(0,St.trimAndCollapseSpaces)(e)),e?fi(e):"?"}function Ja(e){return e??"?"}function Xa(e){return e===void 0?"????.??.??":e.toPGNString()}function Ya(e){switch(e){case"regular":return;case"chess960":return"Fischerandom";case"antichess":return"Antichess";case"horde":return"Horde";default:return e}}function le(e,t){return t!==void 0&&(t=(0,St.trimAndCollapseSpaces)(t)),t?`[${e} "${fi(t)}"]
`:""}function di(e,t){return t===void 0?"":`[${e} "${t}"]
`}function hi(e,t,n,i){for(const l of e.nags())n("$"+l,!1,!1);let r=e.comment();r!==void 0&&(r=(0,St.trimAndCollapseSpaces)(r));const a=e.tags(),s=new Map;let o=!1;for(const l of a){const u=(0,St.trimAndCollapseSpaces)(e.tag(l).replace(/[[\]]/g,""));u&&(s.set(l,u),o=!0)}if(o||r){r&&e.isLongComment()&&e instanceof Ha.Node&&i(),n("{",!1,!0);for(const l of a){const u=s.get(l);u&&n(`[%${l} ${ci(u)}]`,!0,!1)}if(r)for(const l of ci(r).split(" "))n(l,!1,!1);return n("}",!0,!1),r&&e.isLongComment()&&t&&i(),!0}else return!1}function za(e,t,n,i,r){e.moveColor()==="w"?i(e.fullMoveNumber()+".",!1,!1):t&&i(e.fullMoveNumber()+"...",!1,!1),i(e.notation(),!1,!1);const a=e.variations();let s=-1;for(let l=a.length-1;l>=0;--l)if(a[l].first()!==void 0){s=l;break}let o=hi(e,(n||e.next()!==void 0)&&s<0,i,r);for(let l=0;l<a.length;++l){const u=a[l];u.first()!==void 0&&(u.isLongVariation()&&r(),i("(",!1,!0),_i(u,!1,i,r),i(")",!0,!1),l===s&&u.isLongVariation()&&r(),o=!0)}return o}function _i(e,t,n,i){hi(e,!0,n,i);let r=e.first(),a=!0;for(;r!==void 0;)a=za(r,a,t,n,i),r=r.next()}function gi(e,t){let n="";n+=`[Event "${Ct(e.event())}"]
`,n+=`[Site "${Ct(e.site())}"]
`,n+=`[Date "${Xa(e.date())}"]
`,n+=`[Round "${Ja(e.fullRound())}"]
`,n+=`[White "${Ct(e.playerName("w"))}"]
`,n+=`[Black "${Ct(e.playerName("b"))}"]
`,n+=`[Result "${e.result()}"]
`;const i=e.variant(),r=e.initialPosition(),a=!(0,ja.variantWithCanonicalStartPosition)(i)||!ui.Position.isEqual(r,new ui.Position(i))||e.initialFullMoveNumber()!==1;n+=le("Annotator",e.annotator()),n+=di("BlackElo",e.playerElo("b")),n+=le("BlackTitle",e.playerTitle("b")),n+=le("ECO",e.eco()),a&&(n+=`[FEN "${r.fen({fullMoveNumber:e.initialFullMoveNumber(),regularFENIfPossible:!0})}"]
`),n+=le("Opening",e.opening()),t.withPlyCount&&(n+=`[PlyCount "${e.plyCount()}"]
`),a&&(n+=`[SetUp "1"]
`),n+=le("SubVariation",e.openingSubVariation()),n+=le("Termination",e.termination()),n+=le("Variant",Ya(i)),n+=le("Variation",e.openingVariation()),n+=di("WhiteElo",e.playerElo("w")),n+=le("WhiteTitle",e.playerTitle("w")),n+=`
`;let s="",o=!1;function l(f,d,c){s.length===0?s=f:s.length+f.length+(o||d?0:1)<=80?s+=(o||d?"":" ")+f:(n+=s+`
`,s=f),o=c}function u(){n+=s+`
`,n+=`
`,s="",o=!1}return _i(e.mainVariation(),!0,l,u),l(e.result(),!1,!1),n+=s+`
`,n}function Za(e,t){return e.map(n=>gi(n,t)).join(`

`)}/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(vt,"__esModule",{value:!0}),vt.pgnRead=ts,vt.pgnWrite=ns;const es=Ae,Zt=v,mi=Re,Pi=Et,Ni=kt;function ts(e,t){if(typeof e!="string")throw new Zt.IllegalArgument("pgnRead()");if(arguments.length===1)return(0,Pi.readDatabase)(e);if(!(0,es.isValidGameIndex)(t))throw new Zt.IllegalArgument("pgnRead()");return(0,Pi.readOneGame)(e,t)}function ns(e,t){if(t==null&&(t={}),e instanceof mi.Game)return(0,Ni.writeGame)(e,t);if(Array.isArray(e)&&e.every(n=>n instanceof mi.Game))return(0,Ni.writeGames)(e,t);throw new Zt.IllegalArgument("pgnWrite()")}(function(e){/*!
 * -------------------------------------------------------------------------- *
 *                                                                            *
 *    Kokopu - A JavaScript/TypeScript chess library.                         *
 *    <https://www.npmjs.com/package/kokopu>                                  *
 *    Copyright (C) 2018-2024  Yoann Le Montagner <yo35 -at- melix.net>       *
 *                                                                            *
 *    Kokopu is free software: you can redistribute it and/or                 *
 *    modify it under the terms of the GNU Lesser General Public License      *
 *    as published by the Free Software Foundation, either version 3 of       *
 *    the License, or (at your option) any later version.                     *
 *                                                                            *
 *    Kokopu is distributed in the hope that it will be useful,               *
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of          *
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the            *
 *    GNU Lesser General Public License for more details.                     *
 *                                                                            *
 *    You should have received a copy of the GNU Lesser General               *
 *    Public License along with this program. If not, see                     *
 *    <http://www.gnu.org/licenses/>.                                         *
 *                                                                            *
 * -------------------------------------------------------------------------- */Object.defineProperty(e,"__esModule",{value:!0}),e.pgnWrite=e.pgnRead=e.Database=e.Game=e.Variation=e.Node=e.AbstractNode=e.Position=e.isMoveDescriptor=e.MoveDescriptor=e.DateValue=e.isValidECO=e.nagSymbol=e.variantWithCanonicalStartPosition=e.oppositeColor=e.coordinatesToSquare=e.squareToCoordinates=e.squareColor=e.forEachSquare=e.isGameVariant=e.isGameResult=e.isCastle960=e.isCastle=e.isSquareCouple=e.isSquare=e.isRank=e.isFile=e.isColoredPiece=e.isPiece=e.isColor=e.exception=e.i18n=void 0;var t=K;Object.defineProperty(e,"i18n",{enumerable:!0,get:function(){return t.i18n}}),e.exception=v;var n=E;Object.defineProperty(e,"isColor",{enumerable:!0,get:function(){return n.isColor}}),Object.defineProperty(e,"isPiece",{enumerable:!0,get:function(){return n.isPiece}}),Object.defineProperty(e,"isColoredPiece",{enumerable:!0,get:function(){return n.isColoredPiece}}),Object.defineProperty(e,"isFile",{enumerable:!0,get:function(){return n.isFile}}),Object.defineProperty(e,"isRank",{enumerable:!0,get:function(){return n.isRank}}),Object.defineProperty(e,"isSquare",{enumerable:!0,get:function(){return n.isSquare}}),Object.defineProperty(e,"isSquareCouple",{enumerable:!0,get:function(){return n.isSquareCouple}}),Object.defineProperty(e,"isCastle",{enumerable:!0,get:function(){return n.isCastle}}),Object.defineProperty(e,"isCastle960",{enumerable:!0,get:function(){return n.isCastle960}}),Object.defineProperty(e,"isGameResult",{enumerable:!0,get:function(){return n.isGameResult}}),Object.defineProperty(e,"isGameVariant",{enumerable:!0,get:function(){return n.isGameVariant}}),Object.defineProperty(e,"forEachSquare",{enumerable:!0,get:function(){return n.forEachSquare}}),Object.defineProperty(e,"squareColor",{enumerable:!0,get:function(){return n.squareColor}}),Object.defineProperty(e,"squareToCoordinates",{enumerable:!0,get:function(){return n.squareToCoordinates}}),Object.defineProperty(e,"coordinatesToSquare",{enumerable:!0,get:function(){return n.coordinatesToSquare}}),Object.defineProperty(e,"oppositeColor",{enumerable:!0,get:function(){return n.oppositeColor}}),Object.defineProperty(e,"variantWithCanonicalStartPosition",{enumerable:!0,get:function(){return n.variantWithCanonicalStartPosition}}),Object.defineProperty(e,"nagSymbol",{enumerable:!0,get:function(){return n.nagSymbol}}),Object.defineProperty(e,"isValidECO",{enumerable:!0,get:function(){return n.isValidECO}});var i=Ce;Object.defineProperty(e,"DateValue",{enumerable:!0,get:function(){return i.DateValue}});var r=Te;Object.defineProperty(e,"MoveDescriptor",{enumerable:!0,get:function(){return r.MoveDescriptor}}),Object.defineProperty(e,"isMoveDescriptor",{enumerable:!0,get:function(){return r.isMoveDescriptor}});var a=ce;Object.defineProperty(e,"Position",{enumerable:!0,get:function(){return a.Position}});var s=z;Object.defineProperty(e,"AbstractNode",{enumerable:!0,get:function(){return s.AbstractNode}}),Object.defineProperty(e,"Node",{enumerable:!0,get:function(){return s.Node}}),Object.defineProperty(e,"Variation",{enumerable:!0,get:function(){return s.Variation}});var o=Re;Object.defineProperty(e,"Game",{enumerable:!0,get:function(){return o.Game}});var l=Ae;Object.defineProperty(e,"Database",{enumerable:!0,get:function(){return l.Database}});var u=vt;Object.defineProperty(e,"pgnRead",{enumerable:!0,get:function(){return u.pgnRead}}),Object.defineProperty(e,"pgnWrite",{enumerable:!0,get:function(){return u.pgnWrite}})})(Z);const q=["a1","a2","a3","a4","a5","a6","a7","a8","b1","b2","b3","b4","b5","b6","b7","b8","c1","c2","c3","c4","c5","c6","c7","c8","d1","d2","d3","d4","d5","d6","d7","d8","e1","e2","e3","e4","e5","e6","e7","e8","f1","f2","f3","f4","f5","f6","f7","f8","g1","g2","g3","g4","g5","g6","g7","g8","h1","h2","h3","h4","h5","h6","h7","h8"],Ii={n:{a1:-.25,b1:-.2,c1:-.15,d1:-.15,e1:-.15,f1:-.15,g1:-.2,h1:-.25,a2:-.2,b2:-.1,c2:0,d2:0,e2:0,f2:0,g2:-.1,h2:-.2,a3:-.15,b3:0,c3:.05,d3:.075,e3:.075,f3:.05,g3:0,h3:-.15,a4:-.15,b4:.025,c4:.075,d4:.1,e4:.1,f4:.075,g4:.025,h4:-.15,a5:-.15,b5:0,c5:.075,d5:.1,e5:.1,f5:.075,g5:0,h5:-.15,a6:-.15,b6:.025,c6:.05,d6:.075,e6:.075,f6:.05,g6:.025,h6:-.15,a7:-.2,b7:-.1,c7:0,d7:.025,e7:.025,f7:0,g7:-.1,h7:-.2,a8:-.25,b8:-.2,c8:-.15,d8:-.15,e8:-.15,f8:-.15,g8:-.2,h8:-.25},b:{a1:-.1,b1:-.05,c1:-.05,d1:-.05,e1:-.05,f1:-.05,g1:-.05,h1:-.1,a2:-.05,b2:0,c2:0,d2:0,e2:0,f2:0,g2:0,h2:-.05,a3:-.05,b3:0,c3:.05,d3:.075,e3:.075,f3:.05,g3:0,h3:-.05,a4:-.05,b4:0,c4:.075,d4:.1,e4:.1,f4:.075,g4:0,h4:-.05,a5:-.05,b5:0,c5:.075,d5:.1,e5:.1,f5:.075,g5:0,h5:-.05,a6:-.05,b6:0,c6:.05,d6:.075,e6:.075,f6:.05,g6:0,h6:-.05,a7:-.05,b7:0,c7:0,d7:0,e7:0,f7:0,g7:0,h7:-.05,a8:-.1,b8:-.05,c8:-.05,d8:-.05,e8:-.05,f8:-.05,g8:-.05,h8:-.1},r:{a1:0,b1:0,c1:0,d1:0,e1:0,f1:0,g1:0,h1:0,a2:.025,b2:.025,c2:.025,d2:.025,e2:.025,f2:.025,g2:.025,h2:.025,a3:.05,b3:.05,c3:.05,d3:.05,e3:.05,f3:.05,g3:.05,h3:.05,a4:.075,b4:.075,c4:.075,d4:.075,e4:.075,f4:.075,g4:.075,h4:.075,a5:.1,b5:.1,c5:.1,d5:.1,e5:.1,f5:.1,g5:.1,h5:.1,a6:.05,b6:.05,c6:.05,d6:.05,e6:.05,f6:.05,g6:.05,h6:.05,a7:.025,b7:.025,c7:.025,d7:.025,e7:.025,f7:.025,g7:.025,h7:.025,a8:0,b8:0,c8:0,d8:0,e8:0,f8:0,g8:0,h8:0}},bi=new Map([["h1","g3"],["h8","g6"],["a1","b3"],["a8","b6"]]),ze=new Map,is={"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1":["e2e4","d2d4","c2c4","g1f3","b2b3","b1c3","c2c3"],"rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq - 0 1":["e7e5","c7c5","c7c6","d7d6","d7d5","g8f6","b8c6"],"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq - 0 1":["g1f3","b1c3","f1c4","f2f4","d2d4","b2b3","c2c3","g2g3","f1e2","d2d3","a2a3","a2a4","h2h3","b2b4","g2g4","h2h4","f1d3","c2c4"],"rnbqkbnr/pppp1ppp/8/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R b KQkq - 0 1":["b8c6","g8f6","d7d6","f7f5","b7b6","g7g6","f8c5","f8e7","c7c6","a7a6","h7h6","b7b5","g7g5","d7d5","c7c5","a7a5","h7h5","f8d6"],"rnbqkbnr/pp1ppppp/8/2p5/4P3/8/PPPP1PPP/RNBQKBNR w KQkq - 0 1":["g1f3","b1c3","c2c3","d2d4","f2f4","b2b4","c2c4","g2g3","b2b3","f1c4","d2d3","a2a3","h2h3","g1e2","f1e2","b1a3","g2g4","h2h4"],"rnbqkbnr/pp1ppppp/8/2p5/3PP3/8/PPP2PPP/RNBQKBNR b KQkq - 0 1":["c5d4"],"rnbqkbnr/pppp1ppp/4p3/8/4P3/8/PPPP1PPP/RNBQKBNR w KQkq - 0 1":["d2d4","d2d3","b1c3","g1f3","f2f4","c2c4","b2b3","g2g3","c2c3","f1e2"],"rnbqkbnr/pp1ppppp/2p5/8/4P3/8/PPPP1PPP/RNBQKBNR w KQkq - 0 1":["d2d4","b1c3","f2f3","g1f3","c2c4","d2d3","f1d3","f1e2","b2b3","g2g3"],"rnbqkbnr/pp1ppppp/2p5/8/3PP3/8/PPP2PPP/RNBQKBNR b KQkq - 0 1":["d7d5"],"rnbqkbnr/pppppppp/8/8/3P4/8/PPP1PPPP/RNBQKBNR b KQkq - 0 1":["d7d5"],"rnbqkb1r/pppppp1p/5np1/8/3P4/8/PPP1PPPP/RNBQKBNR w KQkq - 0 1":["c2c4","g1f3","b1c3","e2e4","f2f3","g2g3","f1g2","e2e3","h2h3","b2b3"],"rnbqkbnr/pppppppp/8/8/8/2N5/PPPPPPPP/R1BQKBNR b KQkq - 0 1":["e7e5","d7d5","c7c5","g8f6","e7e6","g7g6","b7b6","a7a6","h7h6","f7f5"],"rnbqkbnr/pppppppp/8/8/8/7N/PPPPPPPP/RNBQKB1R b KQkq - 0 1":["e7e5","d7d5","c7c5","g8f6","e7e6","g7g6","b7b6","a7a6","h7h6","f7f5"],"r1bqkb1r/pppp1ppp/2n2n2/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 1":["d2d3","b1c3","d2d4","c2c3","a2a4","b5a4","b5c6","h2h3","g2g3"],"rnbqkb1r/1p2pppp/p2p1n2/8/3NP3/2N5/PPP2PPP/R1BQKB1R w KQkq - 0 1":["f1e2","f1e3","f1d3","g2g4","h2h3","f2f3","c1e3","b2b3","a2a4","d1e2"],"r1bq1rk1/2p1bppp/p1n2n2/1p1pp3/4P3/1BP2N2/PP1P1PPP/RNBQR1K1 w - - 0 1":["h2h3","a2a4","d2d3","d2d4","b3a2","e4d5","e4f5","c3a4","c1a3","f3h4"],"r1bqkb1r/pppp1ppp/2n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQ1RK1 b kq - 0 1":["a7a6","g8f6","d7d6","f8c5","f7f6"],"r1bqk2r/pppp1ppp/2n2n2/1B2p3/4P3/5N2/PPPP1PPP/RNBQ1RK1 b kq - 0 1":["f8e7","f8c5","a7a6","d7d6","b7b5"],"rnbqkbnr/pp2pppp/3p4/2p5/3PP3/5N2/PPP2PPP/RNBQKB1R b KQkq - 0 1":["c5d4","g7g6","b8c6","e7e6","g8f6"],"rnbqkb1r/pp2pppp/3p1n2/8/3NP3/8/PPP2PPP/RNBQKB1R w KQkq - 0 1":["b1c3","f1e2","f1e3","c2c4","f2f3"],"rnbqkbnr/ppp2ppp/4p3/3p4/3PP3/8/PPP2PPP/RNBQKBNR b KQkq - 0 1":["d5e4","g8f6","c7c5","b8c6","f8b4"],"rnbqkb1r/ppp2ppp/4pn2/3p4/3PP3/2N5/PPP2PPP/R1BQKBNR b KQkq - 0 1":["d5e4","f8b4","c7c5","b7b6","c7c6"],"rnbqkbnr/pp2pppp/2p5/3p4/3PP3/8/PPP2PPP/RNBQKBNR b KQkq - 0 1":["d5e4","c6d5","g8f6","c8f5","e7e6"],"rn1qkbnr/pp2pppp/2p5/5b2/3PN3/8/PPP2PPP/R1BQKBNR b KQkq - 0 1":["e7e6","g8f6","b8d7","e7e5","f5g6"],"rnbqkb1r/ppp1pppp/3p1n2/8/3PP3/8/PPP2PPP/RNBQKBNR w KQkq - 0 1":["b1c3","f2f4","g1f3","f1e3","c2c4"],"rnbqkb1r/ppp1pp1p/3p1np1/8/3PP3/2N5/PPP2PPP/R1BQKBNR w KQkq - 0 1":["f2f4","g1f3","f1e3","f1e2","h2h3"],"rnbq1rk1/ppp1ppbp/3p1np1/8/2PPP3/2N2N2/PP3PPP/R1BQKB1R b KQ - 0 1":["e7e5","c7c6","a7a6","b7b6","b8a6"],"rnbq1rk1/pp2ppbp/2pp1np1/8/2PPP3/2N2N2/PP3PPP/R1BQKB1R w KQ - 0 1":["f1e2","h2h3","f1e3","c1e3","d1c2"],"rnbqkb1r/ppp1pp1p/5np1/3p4/2PP4/2N5/PP2PPPP/R1BQKBNR w KQkq - 0 1":["c4d5","g1f3","c1g5","e2e3","d1b3"],"rnbqkb1r/ppp1pp1p/5np1/3P4/3P4/2N5/PP2PPPP/R1BQKBNR b KQkq - 0 1":["g6d5","f8g7","e7e6","c7c6","d8a5"],"rnbqkb1r/ppp2ppp/4pn2/3p4/2PP4/2N5/PP2PPPP/R1BQKBNR w KQkq - 0 1":["g1f3","c4d5","c1g5","e2e3","c4c5"],"rnbqkb1r/pp3ppp/4pn2/2pp4/2PP4/2N2N2/PP2PPPP/R1BQKB1R w KQkq - 0 1":["e2e3","c4d5","c4c5","g2g3","d4c5"],"rnbqkb1r/pp1p1ppp/4pn2/2pP4/2P5/8/PP2PPPP/RNBQKBNR w KQkq - 0 1":["b1c3","e2e4","g1f3","d2d6","g2g3"],"rnbqkb1r/pp1p1ppp/4pn2/2pP4/4P3/2N5/PP3PPP/R1BQKBNR b KQkq - 0 1":["e6d5","g7g6","d7d6","b7b5","h7h6"],"rnbqkb1r/ppppp1pp/5n2/5p2/3P4/6P1/PPP1PP1P/RNBQKBNR b KQkq - 0 1":["g7g6","e7e6","d7d6","c7c6","b7b6"],"rnbqkb1r/ppppp1pp/5n2/5p2/3P4/2N3P1/PPP1PP1P/R1BQKBNR b KQkq - 0 1":["g7g6","e7e6","d7d6","c7c6","b7b6"],"rnbqkb1r/pppp1ppp/4pn2/8/2P5/2N5/PP1PPPPP/R1BQKBNR w KQkq - 0 1":["g2g3","e2e4","g1f3","d2d4","e2e3"],"r1bqkb1r/pppp1ppp/2n1pn2/8/2P5/2N3P1/PP1PPP1P/R1BQKBNR w KQkq - 0 1":["f1g2","g1f3","e2e3","e2e4","d2d4"],"rnbqk2r/pppp1ppp/4pn2/8/1bPP4/2N5/PP2PPPP/R1BQKBNR w KQkq - 0 1":["e2e3","g1f3","c1d2","d1c2","a2a3"],"rnbqk2r/pppp1ppp/4pn2/8/1bPP4/2N2N2/PP2PPPP/R1BQKB1R b KQkq - 0 1":["o-o","c7c5","d7d5","b7b6","b4c3"],"rnbqkb1r/pp1ppppp/8/2p5/4P1n1/5N2/PPPP1PPP/RNBQKB1R w KQkq - 0 1":["h2h3","d2d4","b1c3","e4e5","f3e5"],"r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/2NP1N2/PPP2PPP/R1BQK2R b KQkq - 0 1":["c5b4","o-o","d7d6","b8d4","c5e7"]},pi=new Map(Object.entries(is));function rs(e){if(pi.has(e)){const t=pi.get(e),n=t.length,i=Math.floor(Math.random()*n);return[t[i].slice(0,2),t[i].slice(2,4)]}else return 0}function as(e,t){let n=new Z.Position(e),i=Ze(n),r=new Map,a=new Map;for(const o of i){n=new Z.Position(e),n.play(o);const l=new Map;let u=Ze(n);const f=n.fen();let d=1/0;for(const h of u){n.play(h);let _=Ei(n.fen(),t,2);l.set(h,_),d=Math.min(_,d),n=new Z.Position(f)}let c=u.sort((h,_)=>t?l.get(_)-l.get(h):l.get(h)-l.get(_));r.set(o,d),a.set(f,c.slice(0,150))}let s=i.sort((o,l)=>r.get(l)-r.get(o));return a.set(e,s.slice(0,10)),a}function Ze(e){let t=e.moves();return t.sort((n,i)=>i.isCapture()===n.isCapture()?0:i.isCapture()?1:-1),t=t.filter(n=>!(n.isPromotion()&&n.promotion()!="q")),t}function vi(e,t,n){let i=0;const r=parseInt(e[1]),a=e.charCodeAt(0)-96,s=parseInt(t[1]),o=t.charCodeAt(0)-96,l=Math.max(3-Math.abs(o-4),0),u=Math.max(3-Math.abs(s-4),0),f=l+u;i+=f;const d=Math.abs(a-o),c=Math.abs(r-s),h=d+c;if(i+=14-h,n.length>0){if(d==2&&c==0){i+=5;for(const _ of n){let w=_.charCodeAt(0)-96;o==w&&(i+=20)}}else if(c==2&&d==0){i+=5;for(const _ of n){let w=parseInt(_[1]);s==w&&(i+=20)}}}return i/5}function ss(e,t,n,i){let r=0,a=!1,s=!1;const o=t[0].charCodeAt()-96,l=parseInt(t[1]),u=e[0].charCodeAt()-96,f=parseInt(e[1]);if(n<=4){const d=Math.min(o-1,8-o),c=Math.min(l-1,8-l);r+=(7-d)*5,r+=(7-c)*5;const h=Math.abs(u-o),_=Math.abs(f-l),w=h+_;if(r+=(14-w)*10,(o===1||o===8||l===1||l===8)&&(r+=100),(o===1||o===8)&&(l===1||l===8)&&(r+=200),Math.abs(u-o)===2&&f===l&&(a=!0,r+=100),Math.abs(f-l)===2&&u===o&&(s=!0,r+=100),i.length==2&&(i[0][0]==i[1][0]||i[0][1]==i[1][1])&&(r-=50),i.length>0)for(const et of i){const tt=et[0].charCodeAt()-96,ke=parseInt(et[1]),Ke=Math.abs(tt-o),Be=Math.abs(ke-l),cs=Ke+Be;r+=cs*50,(s&&ke==l||a&&tt==o)&&(r+=1e3)}}return r/100}function os(e,t){const n=t.square(e),i={p:1,b:3,n:3,r:5,q:9,k:0};return n!="-"?n[0]=="w"?["n","b","r"].includes(n[1])?i[n[1]]+Ii[n[1]][e]:i[n[1]]:["n","b","r"].includes(n[1])?-(i[n[1]]+Ii[n[1]][e]):-i[n[1]]:0}function ls(e,t){let n=0,i=parseInt(e[1]),r=t.square(e);return r&&r[1]==="p"?r[0]==="w"?n+=-.12+.1*i:n+=.12-.1*(7-i):0}function us(e,t){return["n","b","q"].includes(t.square(e)[1])?e[1]==1&&t.square(e)[0]=="w"?-.3:e[1]==8&&t.square(e)[0]=="b"?.3:0:0}function Ei(e,t,n){let i=0;const r=new Z.Position(e);let a=0,s=null,o=null,l=[];const u=t?"b":"w";if(r.isCheckmate())return r.turn()=="w"&&t?1e3-n:-1e3+n;if(r.isStalemate()||r.isDead())return 0;for(let f=0;f<q.length;f++)r.square(q[f])!="-"&&(a++,r.square(q[f])[1]=="k"?r.square(q[f])[0]==u?o=q[f]:s=q[f]:r.square(q[f])[1]=="r"&&r.square(q[f])[0]==u&&(l=[...l,q[f]])),i+=os(q[f],r),i+=ls(q[f],r),i+=us(q[f],r);return i=t?-i:i,["c1","g1","c8","g8"].includes(o)&&a>24&&(i+=.5),a<=5&&(i+=ss(o,s,a,l),bi.has(s)&&bi.get(s)==o&&(i+=1),i+=vi(o,s,l)),i}function en(e,t,n,i,r,a,s,o,l,u){i.count++;let f=new Z.Position(e);if(f.isCheckmate()&&!n)return 1e3-t;if(f.isCheckmate()&&n)return t-1e3;if(f.isDead()||f.isStalemate())return 0;if(t==l)return Ei(e,o,t);ze.has(e)&&ze.get(e)[1]==l;{let d=Ze(f);if(u.has(e)?d=u.get(e):t==l-1,n){let c=-1/0;for(const h of d){let _=new Z.Position(e);_.play(h);let w=en(_.fen(),t+1,!1,i,r,a,s,o,l,u);if(c=Math.max(c,w),r=r<w?w:r,r>=a)break}return ze.set(e,[c,l]),c}else{let c=1/0;for(const h of d){let _=new Z.Position(e);_.play(h);let w=en(_.fen(),t+1,!0,i,r,a,s,o,l,u);if(c=Math.min(c,w),a=a<w?a:w,r>=a)break}return ze.set(e,[c,l]),c}}}function fs(e,t=!1){console.time("time");let n=new Z.Position(e),i={count:0},r={count:0},a=null,s=-1/0,o=0;for(const h of q)n.square(h)!="-"&&o++;const l=3,u=Ze(n),f=rs(e);if(f!=0){for(const h of u)if(h.from()==f[0]&&h.to()==f[1])return console.log("TheoryMaster"),[h.from(),h.to(),!1]}let d=as(e,t),c=Ze(n);d.has(e)&&(c=d.get(e));for(const h of c){n.play(h);let _=[],w=null,et=null;const tt=t?"b":"w";for(const Ke of q){const Be=n.square(Ke);Be[1]=="k"?Be[0]==tt?w=Ke:et=Ke:Be[1]=="r"&&Be[0]==tt&&(_=[..._,Ke])}let ke=-9999;ke=en(n.fen(),0,!1,i,-1/0,1/0,r,t,l,d),o<=4&&(ke+=vi(w,et,_)),ke>s&&(s=ke,a=h),n=new Z.Position(e)}return console.log("score is ",s),console.log("bestMove : ",[a.from(),a.to()],s,"number of eval : ",i.count,"number of skips : ",r.count),console.log("transposition table size after this move ",ze.size),console.timeEnd("time"),[a.from(),a.to(),a.isCastling()]}onmessage=function(e){const t=fs(e.data[0],e.data[1],e.data[2]);this.self.postMessage(t)}})();
